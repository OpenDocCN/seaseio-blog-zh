<html>
<head>
<title>A Learning to Rank Project on a Daily Song Ranking Problem – Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">每日歌曲排序问题的学习排序项目-第3部分</h1>
<blockquote>原文：<a href="https://web.archive.org/web/sease.io/2021/03/a-learning-to-rank-project-on-a-daily-song-ranking-problem-part-3.html#0001-01-01">https://web.archive.org/web/sease.io/2021/03/a-learning-to-rank-project-on-a-daily-song-ranking-problem-part-3.html#0001-01-01</a></blockquote>
									<section class="elementor-section elementor-top-section elementor-element elementor-element-9a34ffc ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="9a34ffc" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-4830e02 ot-flex-column-vertical" data-id="4830e02" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-46c240d elementor-widget elementor-widget-text-editor" data-id="46c240d" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="has-text-align-justify translated">我们又来了，用新的知识来排列实现。</p>
<p class="has-text-align-justify translated">如果你正在阅读这篇博文，你可能已经熟悉我们关于每日歌曲排名问题的内部项目，在我们以前的博客(<a href="https://web.archive.org/web/20221130071151/https://sease.io/2020/12/a-learning-to-rank-project-on-a-daily-song-ranking-problem.html">第一部分</a>和<a href="https://web.archive.org/web/20221130071151/https://sease.io/2021/02/a-learning-to-rank-project-on-a-daily-song-ranking-problem-part-2.html">第二部分</a>)中有所描述。如果没有，我建议你先读一读，以便更好地理解我在这里要阐述的内容。</p>
<p class="has-text-align-justify translated">在深入研究这种新方法的细节之前，让我们先对我们的项目做一个简短的总结:</p>
<p class="has-text-align-justify translated">在第一篇博文中，我们展示了建立学习排名(LTR)系统的流程:我们从可用的数据开始，一个Kaggle数据集<a href="https://web.archive.org/web/20221130071151/https://www.kaggle.com/edumucelli/spotifys-worldwide-daily-song-ranking">【1】</a>；我们通过几个数据清理和特征工程技术操纵它；我们创建了训练集和测试集，最后，我们使用XGBoost训练了一个排名模型。</p>
<p class="has-text-align-justify translated">在第二篇博文中，我们使用子集而不是完整的数据集进行了进一步的分析，以检查模型性能方面的差异。我们还通过使用名为SHAP的强大库来解释模型的行为。</p>
<p class="has-text-align-justify translated">在这篇博文中，<strong>我们将创建一个新的查询Id，并检查在构建训练集时发生了什么。</strong></p>
<p class="has-text-align-justify translated">在前面的实验中，我们从单个特征(“Region”列)生成了“query_ID ”,而没有考虑歌曲排行榜的日期。在博客文章<a href="https://web.archive.org/web/20221130071151/https://sease.io/2021/02/a-learning-to-rank-project-on-a-daily-song-ranking-problem-part-2.html">第二部分</a>的第二节中描述的分析过程中，我们意识到我们可以将查询视为多个查询级别特征的散列，以避免每个查询的歌曲“重复”:在特定地区的歌曲排行榜中，一首歌曲可以在排行榜上的同一位置停留几天，甚至几周。</p>
<p class="translated"><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify","textColor":"black"} --><!-- /wp:paragraph --></p>
<p class="translated">此外，如果我们还考虑歌曲图表的日期(日、月和工作日)，我们将获得更具体的查询，从而获得更准确的搜索结果，以便我们可以更好地代表用户的意图和他的需求。</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-9977d59 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="9977d59" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-57917fe ot-flex-column-vertical" data-id="57917fe" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-54df059 elementor-widget elementor-widget-iheading" data-id="54df059" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h2 class="main-heading translated">查询Id生成</h2>	    </div>
	    		</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-587a495 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="587a495" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-7e91332 ot-flex-column-vertical" data-id="7e91332" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-8665754 elementor-widget elementor-widget-text-editor" data-id="8665754" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="has-text-align-justify translated">您应该仔细设计如何计算查询Id。</p>
<p class="has-text-align-justify translated"><strong>查询Id表示每个查询文档样本中&lt; Q，D &gt;的Q，并且您的数据集中的相同查询必须具有相同的Id。</strong></p>
<p class="has-text-align-justify translated">最简单的方法是当您的查询只是一系列自由文本术语时；因此，您必须将相同的术语序列与相同的查询Id相关联。仅此而已。</p>
<p class="has-text-align-justify translated">有时，您可能有一个由用户在搜索过程中选择的一系列过滤查询表示的查询。如果是这样，您可能希望将查询Id作为这些过滤器的组合来计算。查询越准确，搜索结果就越好。<br/>事实上，生成查询Id的另一个好方法是将所有查询级别的特性串联起来(<strong>简单散列，聚类</strong>)。</p>
<p class="has-text-align-justify translated"><em>查询级(或查询相关)特征描述了查询的属性，它们的值仅取决于查询实例。</em> <br/>在我们的例子中，它们是地区、日、月和工作日。</p>
<p class="translated"><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --></p>
<p class="has-text-align-justify translated">所以我们决定修改我们的管道，创建一个不同的查询Id。<br/>让我们回到预处理部分，通过使用一种新方法来生成它:</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-63df3e2 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="63df3e2" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-f508c32 ot-flex-column-vertical" data-id="f508c32" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-682d49f elementor-widget elementor-widget-text-editor" data-id="682d49f" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<pre><code>def <strong>generate_id_from_columns</strong>(input_data_frame, query_features, id_column):
    str_id = input_data_frame[query_features[0]].astype(str)
    for feature in query_features[1:]:
        str_id = str_id + '_' + input_data_frame[feature].astype(str)
    input_data_frame[id_column] = pd.factorize(str_id)[0]</code></pre>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-b0bc4de ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="b0bc4de" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-da522f2 ot-flex-column-vertical" data-id="da522f2" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-749fba3 elementor-widget elementor-widget-text-editor" data-id="749fba3" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">在我们的例子中，参数是:</p>
<ul>
<li style="list-style-type: none;">
 
<ul>
<li class="translated"><strong> input_data_frame </strong>是Spotify数据集(CSV文件)</li>
<li class="translated"><strong> query_features </strong>由以下查询级特性的集合表示:区域、日、月和工作日。</li>
<li class="translated"><strong> id_column </strong>是我们想要创建的特征(我们称之为'<strong> <em> query_ID' </em> </strong>)</li>
</ul>
</li>
</ul>
<p class="has-text-align-justify translated">一旦创建了“<strong> str_id </strong>”作为多个特性的散列，我们就用Pandas factorize()函数对其进行操作，该函数将每个字符串与一个整数唯一地链接起来。</p>
<p class="translated"><!-- wp:paragraph --><!-- /wp:paragraph --><!-- wp:list --><!-- /wp:list --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --></p>
<p class="has-text-align-justify translated">在这里，您可以找到一个示例来理解查询Id创建中的差异:</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-2123fe0 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="2123fe0" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-a6445c3 ot-flex-column-vertical" data-id="a6445c3" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-be53227 elementor-widget elementor-widget-text-editor" data-id="be53227" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><img data-attachment-id="40044" data-permalink="https://web.archive.org/web/20221130071151/https://sease.io/2021/03/a-learning-to-rank-project-on-a-daily-song-ranking-problem-part-3.html/schermata-2021-03-18-alle-07-42-59" data-orig-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-07.42.59.png?fit=2776%2C846&amp;ssl=1" data-orig-size="2776,846" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Schermata 2021-03-18 alle 07.42.59" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-07.42.59.png?fit=300%2C91&amp;ssl=1" data-large-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-07.42.59.png?fit=1024%2C312&amp;ssl=1" decoding="async" loading="lazy" width="2776" height="846" class="wp-image-40044 aligncenter" style="width: 600px;" src="../Images/db3e084e642aff3ff09c9c1dbc52fc91.png" alt="" data-recalc-dims="1" srcset="https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-07.42.59.png?w=2776&amp;ssl=1 2776w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-07.42.59.png?resize=300%2C91&amp;ssl=1 300w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-07.42.59.png?resize=1024%2C312&amp;ssl=1 1024w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-07.42.59.png?resize=768%2C234&amp;ssl=1 768w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-07.42.59.png?resize=1536%2C468&amp;ssl=1 1536w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-07.42.59.png?resize=2048%2C624&amp;ssl=1 2048w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-07.42.59.png?resize=720%2C219&amp;ssl=1 720w" sizes="(max-width: 1000px) 100vw, 1000px" data-original-src="https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-07.42.59.png?ssl=1"/></p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-74ac5f0 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="74ac5f0" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-78b15f7 ot-flex-column-vertical" data-id="78b15f7" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-bc33f16 elementor-widget elementor-widget-text-editor" data-id="bc33f16" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="has-text-align-justify translated">(请注意:为了稍后与“旧”模型进行比较，我们没有删除用于构建查询的日、月和工作日功能。)</p>
<p class="translated"><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} -->T3】</p>
<p class="has-text-align-justify translated">我们还做了一些统计分析来比较新旧查询Id。在下表中，您可以看到在新的实现中，我们有了更多的查询(从54个到19675个),并且每个查询的观察值更少。基本上，虽然我们以前每个查询有大约400个歌曲排行榜，但现在我们只有一个，包含多达200首歌曲(在某些情况下，我们没有完整的排行榜)。标准差告诉我们每个查询Id的行数是否均匀分布。由于这是两个完全不同的实现，所以不容易做直接的比较；然而，我们可以说，在这两种情况下，超过80%的查询id包含超过设定阈值的足够数量的样本，这可能是好的。</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-5fefdeb ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="5fefdeb" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-dfb3444 ot-flex-column-vertical" data-id="dfb3444" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-424e018 elementor-widget elementor-widget-text-editor" data-id="424e018" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><img data-attachment-id="39945" data-permalink="https://web.archive.org/web/20221130071151/https://sease.io/2021/03/a-learning-to-rank-project-on-a-daily-song-ranking-problem-part-3.html/schermata-2021-03-09-alle-08-23-35" data-orig-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-09-alle-08.23.35.png?fit=1132%2C606&amp;ssl=1" data-orig-size="1132,606" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Schermata 2021-03-09 alle 08.23.35" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-09-alle-08.23.35.png?fit=300%2C161&amp;ssl=1" data-large-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-09-alle-08.23.35.png?fit=1024%2C548&amp;ssl=1" decoding="async" loading="lazy" width="1132" height="606" class="wp-image-39945 aligncenter" style="width: 550px;" src="../Images/3b9a1ef36fbeb46aaa53d9ac6acb1cb9.png" alt="" data-recalc-dims="1" srcset="https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-09-alle-08.23.35.png?w=1132&amp;ssl=1 1132w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-09-alle-08.23.35.png?resize=300%2C161&amp;ssl=1 300w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-09-alle-08.23.35.png?resize=1024%2C548&amp;ssl=1 1024w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-09-alle-08.23.35.png?resize=768%2C411&amp;ssl=1 768w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-09-alle-08.23.35.png?resize=720%2C385&amp;ssl=1 720w" sizes="(max-width: 1000px) 100vw, 1000px" data-original-src="https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-09-alle-08.23.35.png?ssl=1"/></p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-01b3b4b ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="01b3b4b" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-43dbbe7 ot-flex-column-vertical" data-id="43dbbe7" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-4b530ba elementor-widget elementor-widget-iheading" data-id="4b530ba" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h2 class="main-heading translated">训练集和测试集分离</h2>	    </div>
	    		</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-85f5fb8 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="85f5fb8" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-cd7277c ot-flex-column-vertical" data-id="cd7277c" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-a33131d elementor-widget elementor-widget-text-editor" data-id="a33131d" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="has-text-align-justify translated">一旦我们获得了具有新查询Id的数据帧，我们就按照以前的博客文章中采用的相同实现将其分为训练集和测试集，我将在这里更具体地描述:</p>
<ol>
<li style="list-style-type: none;">
 
<ol>
<li class="translated">如果我们的查询id有一些低于某个阈值的观察值，我们将这些观察值保存在一个名为<strong> under_sampled_only_train </strong>的新数据帧中，因为我们只希望它们出现在训练集中。只有当测试集出现的次数少于整个数据集的20%时，我们才把它们中的一些移到测试集(具有最高观察次数的查询id)。</li>
<li class="translated">所有的相关性标签必须平均分布。事实上，我们为每个相关性标签手动选择所有观察值的20%,并将它们移动到测试集。这样做，我们确保所有的相关性标签，从0到20，都在两个集合中。</li>
</ol>
</li>
</ol>
<p class="has-text-align-justify translated">有了新的查询Id，我们意识到这个实现不能被应用。在这种情况下，对于每个查询，我们只有一个歌曲图表，因此假设只有一首歌曲具有最高的相关性(在图表的第一个位置):由此得出结论，我们只有一个相关性标签为20的观察结果，并且它永远不会出现在测试集中。</p>
<p class="has-text-align-justify translated">为简单起见，我们以query_ID = 0为例。在下表中，您可以更好地理解到目前为止所解释的内容。<br/>查询0有200个观测值(一张宋图)；我们只有很少的相关性标签从10到20的观察结果(正如在<a href="https://web.archive.org/web/20221130071151/https://sease.io/2020/12/a-learning-to-rank-project-on-a-daily-song-ranking-problem.html">第1部分——相关性评级</a>中应用的映射所预期的那样),它们永远不会被移动到测试集中。为什么？</p>
<ul>
<li style="list-style-type: none;">
 
<ul>
<li class="translated">对于<strong>相关性标签= 0 </strong>,我们总共有50个观察值，我们取这些观察值的20%,因此10行将被移动到测试集。</li>
<li class="translated">对于<strong> Relevance Label = 7 </strong>我们总共有10个观察值，我们取这些观察值的20%,因此将有2行被移动到测试集。</li>
<li class="translated">对于<strong> Relevance Label = 10 </strong>，我们总共有3个观察值，3的20%是0.6，因此没有行将被移动到测试集(对于剩余的行也是如此)。</li>
</ul>
</li>
</ul>
<p class="translated"><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:list {"ordered":true} --><!-- /wp:list --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:list --><!-- /wp:list --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --></p>
<p class="has-text-align-justify translated">因此，不可能在两个集合中都有所有的相关性标签。</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-5a3de4b ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="5a3de4b" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-cc21b47 ot-flex-column-vertical" data-id="cc21b47" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-1515a30 elementor-widget elementor-widget-text-editor" data-id="1515a30" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><img data-attachment-id="40058" data-permalink="https://web.archive.org/web/20221130071151/https://sease.io/2021/03/a-learning-to-rank-project-on-a-daily-song-ranking-problem-part-3.html/schermata-2021-03-18-alle-10-06-49" data-orig-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-10.06.49.png?fit=1138%2C1158&amp;ssl=1" data-orig-size="1138,1158" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Schermata 2021-03-18 alle 10.06.49" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-10.06.49.png?fit=295%2C300&amp;ssl=1" data-large-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-10.06.49.png?fit=1006%2C1024&amp;ssl=1" decoding="async" loading="lazy" width="1138" height="1158" class="wp-image-40058 aligncenter" style="width: 450px;" src="../Images/0d4bbac85d90a92aa37d9a459cb73586.png" alt="" data-recalc-dims="1" srcset="https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-10.06.49.png?w=1138&amp;ssl=1 1138w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-10.06.49.png?resize=295%2C300&amp;ssl=1 295w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-10.06.49.png?resize=1006%2C1024&amp;ssl=1 1006w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-10.06.49.png?resize=768%2C781&amp;ssl=1 768w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-10.06.49.png?resize=720%2C733&amp;ssl=1 720w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-10.06.49.png?resize=45%2C45&amp;ssl=1 45w" sizes="(max-width: 1000px) 100vw, 1000px" data-original-src="https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-18-alle-10.06.49.png?ssl=1"/></p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-a58cc42 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="a58cc42" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-694f312 ot-flex-column-vertical" data-id="694f312" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-1e0f79a elementor-widget elementor-widget-text-editor" data-id="1e0f79a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">我们决定实现一种不同的方法:我们随机打乱数据帧，然后将其分成训练集和测试集，确保每个查询Id的20%的观察结果移动到测试集，而与相关性标签无关。当然，最好在两个集合中都有相关性标签，但这样一来，它们的分布至少变得更加公平。</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-ec7cca8 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="ec7cca8" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-b35f14e ot-flex-column-vertical" data-id="b35f14e" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-eb27c56 elementor-widget elementor-widget-text-editor" data-id="eb27c56" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><img data-attachment-id="39929" data-permalink="https://web.archive.org/web/20221130071151/https://sease.io/2021/03/a-learning-to-rank-project-on-a-daily-song-ranking-problem-part-3.html/schermata-2021-03-07-alle-14-08-52" data-orig-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-07-alle-14.08.52.png?fit=1132%2C1144&amp;ssl=1" data-orig-size="1132,1144" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Schermata 2021-03-07 alle 14.08.52" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-07-alle-14.08.52.png?fit=297%2C300&amp;ssl=1" data-large-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-07-alle-14.08.52.png?fit=1013%2C1024&amp;ssl=1" decoding="async" loading="lazy" width="1132" height="1144" class="wp-image-39929 aligncenter" style="width: 450px;" src="../Images/43bfb30dd7e39faa2c01f6f67e0d29f9.png" alt="" data-recalc-dims="1" srcset="https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-07-alle-14.08.52.png?w=1132&amp;ssl=1 1132w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-07-alle-14.08.52.png?resize=297%2C300&amp;ssl=1 297w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-07-alle-14.08.52.png?resize=1013%2C1024&amp;ssl=1 1013w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-07-alle-14.08.52.png?resize=768%2C776&amp;ssl=1 768w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-07-alle-14.08.52.png?resize=720%2C728&amp;ssl=1 720w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-07-alle-14.08.52.png?resize=45%2C45&amp;ssl=1 45w" sizes="(max-width: 1000px) 100vw, 1000px" data-original-src="https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-07-alle-14.08.52.png?ssl=1"/></p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-f5f7bcc ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="f5f7bcc" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-40d2398 ot-flex-column-vertical" data-id="40d2398" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-edddd8b elementor-widget elementor-widget-text-editor" data-id="edddd8b" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">最后，我们使用LambdaMART训练了一个学习排序模型。使用旧的分割，我们将在具有所有相关性标签的样本上训练模型，但是它们中的大多数(从10到20)将不会被测试，因为它们不存在于测试集中。如果没有对一部分重要数据进行测试，我们如何判断模型是否表现良好？！</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-b549bd0 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="b549bd0" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-6f806a6 ot-flex-column-vertical" data-id="6f806a6" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-e146e04 elementor-widget elementor-widget-iheading" data-id="e146e04" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h2 class="main-heading translated">结果</h2>	    </div>
	    		</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-423eef1 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="423eef1" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-450b322 ot-flex-column-vertical" data-id="450b322" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-e2dd03c elementor-widget elementor-widget-text-editor" data-id="e2dd03c" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="has-text-align-justify translated">在这个新的实施中，我们采取了不同的方法，将管道分为两个部分:</p>
<ol>
<li style="list-style-type: none;">
 
<ol>
<li class="translated">当生成查询Id时</li>
<li class="translated">在我们分割数据集的阶段</li>
</ol>
</li>
</ol>
<p class="translated"><!-- wp:paragraph {"align":"justify"} --> <!-- /wp:paragraph --> <!-- wp:list {"ordered":true} --> <!-- /wp:list --> <!-- wp:paragraph --></p>
<p class="translated">让我们检查获得的结果:</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-78af317 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="78af317" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-160674a ot-flex-column-vertical" data-id="160674a" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-d8c4e16 elementor-widget elementor-widget-text-editor" data-id="d8c4e16" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><img data-attachment-id="39981" data-permalink="https://web.archive.org/web/20221130071151/https://sease.io/2021/03/a-learning-to-rank-project-on-a-daily-song-ranking-problem-part-3.html/schermata-2021-03-16-alle-08-47-20" data-orig-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-16-alle-08.47.20.png?fit=512%2C140&amp;ssl=1" data-orig-size="512,140" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Schermata 2021-03-16 alle 08.47.20" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-16-alle-08.47.20.png?fit=300%2C82&amp;ssl=1" data-large-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-16-alle-08.47.20.png?fit=512%2C140&amp;ssl=1" decoding="async" loading="lazy" width="512" height="140" class="wp-image-39981 aligncenter" style="width: 300px;" src="../Images/fa3f465eef8b1b9459b5a196d9a24d67.png" alt="" data-recalc-dims="1" srcset="https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-16-alle-08.47.20.png?w=512&amp;ssl=1 512w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-16-alle-08.47.20.png?resize=300%2C82&amp;ssl=1 300w" sizes="(max-width: 512px) 100vw, 512px" data-original-src="https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-16-alle-08.47.20.png?ssl=1"/></p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-cb188a9 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="cb188a9" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-5a22722 ot-flex-column-vertical" data-id="5a22722" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-f9950ad elementor-widget elementor-widget-text-editor" data-id="f9950ad" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="has-text-align-justify translated">您可以看到，我们使用哈希编码的变体(对于‘Title’特性)比另一个变体(Doc2Vec编码)具有更好的模型性能。</p>
<p class="has-text-align-justify translated">使用哈希编码，我们检查了使用新旧查询Id训练模型之间的差异，然后我们在相同的测试集上测试了这些模型。两个型号的特征相同，因此可以进行比较；唯一改变的是查询Id。在第一个实现(OldQueryId模型)中，我们的目标是获得基于地区的最佳排序，而现在我们的目标是获得基于地区、日、月和工作日的最佳排序。</p>
<p class="has-text-align-justify translated">当我们使用两个不同模型的训练集和测试集时，我们必须确保它们之间没有交集:这意味着测试集的观察值在训练时必须是未知的。</p>
<p class="translated"><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} -->T8】</p>
<p class="has-text-align-justify translated">例如，我们以“OldQueryId模型”的训练集和“NewQueryId模型”的测试集为例。我们必须检查它们是否有共同的观察值，这意味着如果两行对于除查询Id之外的所有特性都有相同的值，我们就认为这两行是相同的。我们在Pandas<a href="https://web.archive.org/web/20221130071151/https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.merge.html">【2】</a>中使用了合并功能:</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-68a215b ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="68a215b" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-17a5dfb ot-flex-column-vertical" data-id="17a5dfb" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-03eb6cf elementor-widget elementor-widget-text-editor" data-id="03eb6cf" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<pre><code>intersections = training_set.merge(test_set, how='inner', on='cols')</code></pre>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-cba97df ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="cba97df" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-c1acca3 ot-flex-column-vertical" data-id="c1acca3" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-9aadb32 elementor-widget elementor-widget-text-editor" data-id="9aadb32" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="has-text-align-justify translated">其中:</p>
<ul>
<li style="list-style-type: none;">
 
<ul>
<li class="translated"><strong>交集</strong> =将包含训练集和测试集之间共有的所有行</li>
<li class="translated"><strong> training_set </strong>:数据帧=旧查询Id的训练集</li>
<li class="translated"><strong> test_set </strong>:要合并的对象=具有新查询Id的测试集(哈希)</li>
<li class="translated"><strong>如何</strong>:要执行的合并类型= <em>'内部</em>'连接以获取交集</li>
<li class="translated"><strong>on</strong>:column to join on = '<em>cols</em>'(除查询Id外的所有特性)</li>
</ul>
</li>
</ul>
<p class="translated"><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:list --><!-- /wp:list --><!-- wp:paragraph {"align":"justify"} -->T30】</p>
<p class="has-text-align-justify translated">查询Id被排除在外，因为它是在这两个实现过程中唯一被不同操作的特性。在匹配的情况下，我们从训练集中删除公共行，并将它们留在测试集中。</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-fe1208a ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="fe1208a" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-447ac4f ot-flex-column-vertical" data-id="447ac4f" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-23e55b3 elementor-widget elementor-widget-text-editor" data-id="23e55b3" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><img data-attachment-id="39983" data-permalink="https://web.archive.org/web/20221130071151/https://sease.io/2021/03/a-learning-to-rank-project-on-a-daily-song-ranking-problem-part-3.html/schermata-2021-03-16-alle-09-10-01" data-orig-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-16-alle-09.10.01.png?fit=844%2C234&amp;ssl=1" data-orig-size="844,234" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Schermata 2021-03-16 alle 09.10.01" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-16-alle-09.10.01.png?fit=300%2C83&amp;ssl=1" data-large-file="https://web.archive.org/web/20221130071151/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-16-alle-09.10.01.png?fit=844%2C234&amp;ssl=1" decoding="async" loading="lazy" width="844" height="234" class="wp-image-39983 aligncenter" style="width: 500px;" src="../Images/747e97806b11997dfa44e4fce06609c8.png" alt="" data-recalc-dims="1" srcset="https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-16-alle-09.10.01.png?w=844&amp;ssl=1 844w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-16-alle-09.10.01.png?resize=300%2C83&amp;ssl=1 300w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-16-alle-09.10.01.png?resize=768%2C213&amp;ssl=1 768w, https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-16-alle-09.10.01.png?resize=720%2C200&amp;ssl=1 720w" sizes="(max-width: 844px) 100vw, 844px" data-original-src="https://web.archive.org/web/20221130071151im_/https://i0.wp.com/sease.io/wp-content/uploads/2021/12/Schermata-2021-03-16-alle-09.10.01.png?ssl=1"/></p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-0d62e06 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="0d62e06" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-a737ee8 ot-flex-column-vertical" data-id="a737ee8" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-a6ec441 elementor-widget elementor-widget-text-editor" data-id="a6ec441" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">总的来说，我们可以看到使用新查询ID的模型性能更好。作为多个查询级别特征的散列的查询Id能够返回更好的搜索结果排序。当我们使用新query_ID的训练集和旧query_ID的测试集(反之亦然)时，<em> train-ndcg@10 </em>下降了一点点。这可能是因为从定型集中删除了公共行，因此模型需要学习的输入数据较少。</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-be82040 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="be82040" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-00dcc69 ot-flex-column-vertical" data-id="00dcc69" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-d6192ef elementor-widget elementor-widget-iheading" data-id="d6192ef" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h6 class="main-heading translated">最终考虑</h6>	    </div>
	    		</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-b7a772d ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="b7a772d" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-61bc255 ot-flex-column-vertical" data-id="61bc255" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-4c1cb73 elementor-widget elementor-widget-text-editor" data-id="4c1cb73" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><strong>如果可能，查询Id应包含所有查询级别的特征</strong>。</p>
<p class="has-text-align-justify translated"><strong>目标是达到每个查询Id样本的均匀分布。</strong>事实上，您需要小心计算查询id的方式:如果粒度太细，您可能会得到很多样本很少的查询id；另一方面，如果你放松你的粒度，你可能最终会得到一个庞大的排名列表，但却不那么精确，因为它们代表了更广泛的概念。你应该试着平衡一下。</p>
<p class="has-text-align-justify translated"><strong>如果查询id欠采样，则丢弃训练样本</strong>。也许还应该说，这必须语境化。如果我们有可靠的数据，并且确信我们已经适当地管理了可能导致NDCG暴涨的条件，我们可以尝试将这些观察值保留在训练集中，或者为所有这些观察值分配一个新的查询Id。</p>
<p class="translated">如果您清理数据集，然后分割它，您必须小心，因为您可能会得到一个不公平的测试集:</p>
<p class="translated"><!-- wp:paragraph --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph {"align":"justify"} --><!-- /wp:paragraph --><!-- wp:paragraph --><!-- /wp:paragraph --><!-- wp:list --><!-- /wp:list --></p>
<ul>
<li style="list-style-type: none;">
 
<ul>
<li class="translated">测试集不能有欠采样的查询id</li>
<li class="translated">测试集不能有带有单个相关性标签的查询id</li>
<li class="translated">测试集必须具有代表性，并且具有可接受的大小(根据每个查询的观察值)</li>
<li class="translated">可能地，所有相关性标签都应该在两个集合中</li>
</ul>
</li>
</ul>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-77e6b21b ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="77e6b21b" data-element_type="section" data-settings="{&quot;background_background&quot;:&quot;classic&quot;}">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-2e456d57 ot-flex-column-vertical" data-id="2e456d57" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-6a10872a elementor-widget elementor-widget-iheading" data-id="6a10872a" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>// our service</span>
	        <h2 class="main-heading translated">不要脸的塞给我们培训和服务！</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-1f874c60 elementor-widget elementor-widget-text-editor" data-id="1f874c60" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">我提到过我们做<a href="https://web.archive.org/web/20221130071151/https://sease.io/learning-to-rank-training">学习排名</a>和<a href="https://web.archive.org/web/20221130071151/https://sease.io/training/search-relevance-training/search-relevance-training-solr">搜索相关性</a>培训吗？<br/>我们还提供关于这些主题的咨询，<a href="https://web.archive.org/web/20221130071151/https://sease.io/contacts">如果您想让您的搜索引擎更上一层楼，请联系</a>！</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-613eb290 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="613eb290" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-4de0bfa ot-flex-column-vertical" data-id="4de0bfa" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-c9efdb0 elementor-widget elementor-widget-iheading" data-id="c9efdb0" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>// STAY ALWAYS UP TO DATE</span>
	        <h2 class="main-heading translated">订阅我们的时事通讯</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-4c6d8843 elementor-widget elementor-widget-text-editor" data-id="4c6d8843" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">你喜欢这篇关于Drop constant features:一个现实世界的学习排名场景的帖子吗？不要忘记订阅我们的时事通讯，以便随时了解信息检索世界的最新动态！</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-69624e7a elementor-widget elementor-widget-wp-widget-mc4wp_form_widget" data-id="69624e7a" data-element_type="widget" data-widget_type="wp-widget-mc4wp_form_widget.default">
				<div class="elementor-widget-container">
			<script>(function() {
	window.mc4wp = window.mc4wp || {
		listeners: [],
		forms: {
			on: function(evt, cb) {
				window.mc4wp.listeners.push(
					{
						event   : evt,
						callback: cb
					}
				);
			}
		}
	}
})();
</script><!-- Mailchimp for WordPress v4.8.11 - https://wordpress.org/plugins/mailchimp-for-wp/ --><form id="mc4wp-form-1" class="mc4wp-form mc4wp-form-1343" method="post" data-id="1343" data-name="Sease Mailchimp"><div class="mc4wp-form-fields">
<div class="subscribe-inner-form">
	<input type="email" name="EMAIL" placeholder="Your Email" required=""/>
	<button type="submit" class="subscribe-btn-icon"><i class="flaticon-telegram"/></button>
</div>	

<p class="translated"><label> <input name="AGREE_TO_TERMS" type="checkbox" value="1" required=""/> <a href="https://web.archive.org/web/20221130071151/https://sease.io/privacy-policy" target="_blank">我已经阅读并同意隐私政策</a> </label></p></div><label style="display: none !important;">Leave this field empty if you're human: <input type="text" name="_mc4wp_honeypot" value="" tabindex="-1" autocomplete="off"/></label><input type="hidden" name="_mc4wp_timestamp" value="1669792311"/><input type="hidden" name="_mc4wp_form_id" value="1343"/><input type="hidden" name="_mc4wp_form_element_id" value="mc4wp-form-1"/><div class="mc4wp-response"/></form><!-- / Mailchimp for WordPress Plugin -->		</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
									    
</body>
</html>