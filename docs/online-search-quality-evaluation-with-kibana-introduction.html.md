# 使用 Kibana 进行在线搜索质量评估——简介

> 原文：<https://web.archive.org/web/sease.io/2023/03/online-search-quality-evaluation-with-kibana-introduction.html>

嗨读者们！

这篇文章的目的是向**展示如何使用 Kibana 来有效地监控和分析在线搜索质量评估的结果**，让用户更容易确定需要改进的地方。

这篇博文提供了对在线搜索质量评估和 A/B 测试的一般理解，解释了为什么这些很重要。然后将介绍在实施这些评估中使用 Kibana(及其背后的动机)。最后总结了使用 Kibana 进行在线搜索质量评估的优缺点。

第二篇博文将会发布，重点是 Kibana 提供的具体特性和工具。它将提供如何创建可视化和仪表板的实际例子，以帮助比较不同的排名模型。

// WHAT TO EXPECT TO FIND IN THIS BLOG POST

*   [什么是网上评价？](#OnlineEvaluation)
*   [A/B 测试](#ab)
    –[信号测量](#signal)–[实验设计](#experiment)
*   [Kibana 实现](#implementation)
    –[实现步骤](#steps)
    –[场景](#scenario)
*   基巴纳的优点&缺点

## 什么是网上测评？

搜索质量评估是信息检索的一个分支，旨在评估您的搜索系统在满足用户信息需求方面有多好。有几种方法可以衡量搜索引擎的质量:从相关性的角度来看，搜索引擎应该返回与用户查询相关的结果，这可以通过离线和在线评估来衡量，这两种评估对企业来说都是至关重要的。

首先，重要的是要做一个好的**离线**搜索质量评估，通过评估一个候选发布在网上的表现来尽可能多的验证它。

一个已发布版本的成败最终取决于在线测试，在这里你可以实时(在生产中)测量你的业务的重要指标。

在线评估仍然是证明您的模型在现实世界中表现如何的最佳方式，它可以为您提供必要的信息来评估、改进和更好地了解您的模型的行为。

如果你感兴趣，可以看看我们之前讨论搜索质量评估的博客文章:

*   [在线测试在学习排名中的重要性第一部分](https://web.archive.org/web/20230327130054/https://sease.io/2020/04/the-importance-of-online-testing-in-learning-to-rank-part-1.html)
*   [学习排名在线测试:交错](https://web.archive.org/web/20230327130054/https://sease.io/2020/05/online-testing-for-learning-to-rank-interleaving.html)
*   [离线搜索质量评价:评分排名评价员(RRE)](https://web.archive.org/web/20230327130054/https://sease.io/2021/01/offline-search-quality-evaluation-rated-ranking-evaluator-rre.html)

## A/B 测试

一般来说，当一个新模型在离线测试中表现出令人满意的性能，并被认为是一个很好的候选时，直观的解决方案可能涉及用新模型替换以前的模型。然而，这种方法可能涉及潜在的风险，并不被认为是最佳的。作为最佳实践，建议对新旧模型进行在线比较，以评估它们在现实条件下的性能。怎么会？

业界广泛传播的两种在线测试是 A/B 测试和交错测试。我们的实现使用了 A/B 测试，因此只简要讨论这种方法。

从下图中可以很容易地看出，A/B 测试包括通过将观众分成两组(每个模型一组)来比较两个模型，通常是 50/50:

![](img/39444ea4a2497830cbbf19b4922215c9.png)

与交错相比，A/B 测试更容易实现，但需要更高的流量和时间，并且可能在整个实验期间将一组用户暴露于不良的排名模型。

如果你想了解更多关于 A/B 测试的知识，可以看看这篇博文中关于[在线测试在学习排名](https://web.archive.org/web/20230327130054/https://sease.io/2020/04/the-importance-of-online-testing-in-learning-to-rank-part-1.html)中的重要性的相关部分。

### 测量信号

在线评估可以考虑几个指标，每个指标代表搜索质量的一个特定方面:

Click-Through Rate (CTR)

最普通也是最重要的。这是一个指标，计算方法是将文档/产品的点击数除以其收到的印象数或浏览量。我们的目标是优化 CTR 这意味着当用户搜索某样东西时，我们希望搜索结果会提示他们与搜索引擎进行交互，例如通过点击商品/产品，甚至下载歌曲，将酒店添加到收藏夹，或任何其他类型的交互。

Sale/Revenue Rate

如果您处于电子商务环境中，监控和优化销售和收入等业务指标至关重要；简单地实现高点击率并不能保证有效的搜索引擎性能，因为缺乏相应的销售或收入可能表明用户体验或底层搜索算法的其他问题。

DWELL Time

它是用户点击查询结果后在搜索引擎结果页面上花费的时间长度。该指标反映了用户在多长时间内发现内容有用或信息丰富，因此长时间表明点击的内容与用户相关。

Query Reformulations

查询重构的数量指的是用户修改原始搜索查询(即，重写相同的查询)以改进搜索引擎返回的结果的次数。一般来说，目标应该是用尽可能少的查询重构来达到令人满意的信息检索水平。

Bounce Rates

搜索引擎中的跳出率是指仅访问一个页面后就离开搜索结果页面的用户的百分比。高跳出率可能表明搜索结果与用户的需求不相关或者用户体验差。

建议从最接近你的搜索引擎的信号开始，然后逐步监控全部。

### 试验设计

某些方面可能受益于进一步的考虑，以优化实验的设计和执行，导致更有见地和更可靠的结果；例如，考虑使用不同设备对结果的影响，评估实验的最佳时间长度以确保充分的数据收集，或者确定最合适的模型数量以考虑可以帮助最大化实验的效率和有效性。

1\. TESTING DIFFERENT PLATFORMS

在现实场景中，系统部署在不同的平台上:桌面、移动和平板电脑。在每个平台上独立测试模型是一个很好的实践，因为度量标准和目标受众可能因平台而异，并影响结果。

2\. HOW LONG TO TEST

当结果的统计显著性足够高时，应停止测试。一般来说，模型的测试时间不应少于两周。

3\. HOW MANY MODELS

可以同时比较多个模型，从两个到多个。要比较的系统数量取决于可用的流量。然而，比较的系统越多，就越难确定谁是赢家。一般建议尽可能简化比较过程。

另一个需要考虑的重要方面是**噪声**。例如，当比较模型时，许多公司评估点击或销售的总数，没有意识到只关注来自他们在线评估的搜索引擎结果页面的交互(数据)而不考虑来自不同页面或来源的交互是重要的。我们的建议总是尽可能地消除或减少噪音。

// WANT TO KNOW MORE ABOUT HOW SEARCH QUALITY EVALUATION WORKS?

搜索结果的质量对任何搜索工程师和产品经理来说都是一件大事。
我们花了很多精力来改进衡量这些指标的方法，并以不同的方式开展这些研究:

01

##### 搜索质量评估培训

We offer different Search Quality Evaluation Training sessions.[*LEARN MORE*](https://web.archive.org/web/20230327130054/https://sease.io/training/search-quality-evaluation-trainings)*02

##### 搜索结果质量的免费工具

We develop a free tool for evaluate the quality of your search engine.[*DOWNLOAD IT*](https://web.archive.org/web/20230327130054/https://sease.io/rated-ranking-evaluator-enterprise)*03

##### 关于搜索质量评估的博客帖子

We publish weekly blog posts and a lot of them are about this topic![*CHECK THEM*](https://web.archive.org/web/20230327130054/https://sease.io/tag/search-quality-evaluation)** ***## 基巴纳实施

现在，让我们深入研究我们的 Kibana 实现。

**Kibana** 是一个数据可视化和探索平台，它提供了一个 web 界面，用于交互、搜索、分析和可视化存储在 Elasticsearch 中的数据，使用户可以轻松创建和保存自定义仪表板，并执行高级数据分析和报告。

选择这种实现方式背后的 ***主要因素*** 有哪些？

尽管在线评估工具具有其他优势，但目前在可使用的指标和数据方面存在一些限制:

*   寻找和使用用于优化模型的相同指标是一项挑战
*   很难消除外部因素或损坏的数据

这就是为什么我们选择使用 Kibana 来实现我们的在线评估。

### 实施步骤

下面是用 Kibana 实现这种在线搜索质量评估的管道:

1.  创建一个 Elasticsearch 实例并注册 Kibana。
2.  创建一个索引，如果可能，指定一个显式映射。
3.  设置并开始 A/B 测试。
4.  收集用户交互数据并建立索引。
5.  在 Kibana 中创建一个[数据视图](https://web.archive.org/web/20230327130054/https://www.elastic.co/guide/en/kibana/current/data-views.html)，以访问您想要探索的 Elasticsearch 数据。
6.  利用 Kibana 工具创建可视化和仪表板来比较不同的模型。

### 方案

在这种情况下，我们假设在*图书电子商务场景*中，我们每天收集用户交互，以了解用户如何与搜索引擎交互，例如:

*   **bookId** :标识特定产品
*   **testGroup** :识别分配给用户组的型号(名称)
*   **queryId** :识别用户查询
*   **时间戳**:执行时间分析
*   **互动类型**(印象、点击、添加到购物车、销售)，了解发生的互动类型。我们还包括了 4 个单布尔字段(包含 0 或 1，取决于出现的次数),它们只是用于创建特定可视化的计算目的:
    *   **印象**
    *   **点击**
    *   **添加图标**
    *   **特卖**
*   **queryResultCount** (查询命中)，根据给定查询返回的搜索结果数量进行分析

注意:请随意考虑和添加任何对您的案例和领域有益的附加功能。

我们在 Elasticseach 索引中索引这些数据，并利用 Kibana 通过创建特定的可视化(基于过滤数据)来探索这些数据并评估模型(通过`testGroup`字段标识)的性能。

请参考[第 2 部分](https://web.archive.org/web/20230327130054/https://sease.io/wp-admin/post.php?post=57612&action=edit&calypsoify=1)中的“可视化示例”描述。

## 基巴纳利弊

乐总结了第一篇博客的优缺点。

PROS

*   Kibana 有一个简单直观的图形用户界面。
*   它能够创建详细的报告仪表板(将几个可视化集合在一起)。
*   它能够过滤不想要的数据(损坏的交互/测试交互/不想要的源)。
*   可以使用过滤器面板指定要突出显示的数据。
*   如果您索引新数据，可视化效果会自动更新。
*   它提供了使用**‘Export objects API’**导出(和导入)可视化和仪表板的可能性，允许在未来的项目中复制自定义评估。

CONS

*   **VEGA** 非常强大，但使用起来并不那么直观和简单(*“推荐给擅长手动编写 Elasticsearch 查询的高级用户”*)。
*   如果测试了一个新模型(模型名称改变)或者数据视图被重命名，您将需要手动更新所有可视化中的过滤器。

// our service

## 还在纠结用 Kibana 做在线搜索质量评估？

别担心，我们是来帮忙的！
我们的团队提供 **咨询服务** 帮助您提高搜索结果质量，充分利用您的系统。立即联系我们，了解更多信息！

[Send us an e-mail](https://web.archive.org/web/20230327130054/mailto:info@sease.io)// STAY ALWAYS UP TO DATE

## 订阅我们的时事通讯

你喜欢这个关于 Kibana 在线搜索质量评估的帖子吗？不要忘记订阅我们的时事通讯，以便在信息检索世界中保持最新状态！***