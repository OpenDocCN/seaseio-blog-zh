<html>
<head>
<title>SolrCloud exceptions with Apache Zookeeper</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Apache Zookeeper的SolrCloud异常</h1>
<blockquote>原文：<a href="https://web.archive.org/web/sease.io/2018/05/solrcloud-exceptions-with-apache-zookeeper.html#0001-01-01">https://web.archive.org/web/sease.io/2018/05/solrcloud-exceptions-with-apache-zookeeper.html#0001-01-01</a></blockquote>
									<section class="elementor-section elementor-top-section elementor-element elementor-element-848f9bc ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="848f9bc" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-01ddf0b ot-flex-column-vertical" data-id="01ddf0b" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-c16ab68 elementor-widget elementor-widget-text-editor" data-id="c16ab68" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">目前(Solr 7.3.1 ) SolrCloud是Apache Solr的一个可靠而稳定的分布式架构。但是它并不完美，失败时有发生。</p><p class="translated">Apache Zookeeper<a href="https://web.archive.org/web/20230226232125/https://zookeeper.apache.org/" target="_blank" rel="noopener">【1】</a>是负责管理整个SolrCloud集群通信的系统。<br/>它包含共享集合配置，并具有集群状态视图。<br/>它是集群大脑的一部分，是维持集群健康运转的守护者。</p><p class="translated">它能够回答以下问题:</p><div class="page" title="Page 1"><div class="section"><div class="layoutArea"><div class="column"><p style="padding-left: 40px;" class="translated">谁是这个碎片和系列的领导者？<br/>此节点是否关闭？<br/>这个节点正在恢复吗？</p><p class="translated">Solr节点与Zookeeper通信，以了解在运行SolrCloud操作时应该联系谁。</p><p class="translated">这篇关于lightening的博文将提供一些实用的技巧，供您的客户端应用程序在处理SolrCloud和Apache Zookeeper时遇到一些经典异常时参考。<br/>特别感谢Apache Solr用户邮件列表贡献者和Apache Solr社区，这篇文章汇集了来自他们以及官方代码和文档的建议。</p></div></div></div></div>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-f38fbe7 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="f38fbe7" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-c0bf6e7 ot-flex-column-vertical" data-id="c0bf6e7" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-a3884f2 elementor-widget elementor-widget-iheading" data-id="a3884f2" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h2 class="main-heading translated">org . Apache . Solr . common . Solr exception:<br/>无法从ZK加载集合:<br/> &lt;集合名称&gt;</h2>	    </div>
	    		</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-8a2f96a ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="8a2f96a" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-d059fc7 ot-flex-column-vertical" data-id="d059fc7" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-2b5c92e elementor-widget elementor-widget-text-editor" data-id="2b5c92e" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">如果您在这里登陆时只出现了那个异常，我假设有一个缺失:<br/>“由:org . Apache . zookeeper . keeper Exception $ SessionExpiredException:keeper error code = Session expired for/collections/&lt;collections name&gt;/state . JSON”导致？</p><p class="translated">Solr的<strong>zkclientimeout</strong>用于设置ZooKeeper的sessionTimeout，这是一个会话到期时所超出的。<br/>当这种异常发生时，这意味着Solr-Zookeeper通信中出现了非常严重的问题，30秒(当前默认的<a href="https://web.archive.org/web/20230226232125/https://issues.apache.org/jira/browse/SOLR-5565" target="_blank" rel="noopener">【2】</a>)是应用程序尝试通信的一段非常长的时间。</p><p class="translated"><strong>推荐</strong>:照顾好身边不同的暂停时间，不要让它们太小！<br/>即，为zkClientTimeout指定一个值&gt; = 30秒<strong>。</strong></p><p class="translated"><strong>maxSessionTimeout</strong>(Zookeeper)<br/>3 . 3 . 0中新增:服务器允许客户端协商的最大会话超时时间(毫秒)。默认为tickTime的20倍。</p><p class="translated"><strong>zkclienttime out</strong>(Solr)<br/>控制你的客户端超时。</p><p class="translated">检查超时后，让我们探索一些可能的根本原因。<br/>会话过期可能由以下原因引起:</p><p style="padding-left: 40px;" class="translated">1.Solr node/Zookeeper上的垃圾收集——当堆太小或太大时，会发生极端的垃圾收集暂停。磁盘上的IO变慢。<br/> 3。网络延迟</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-a2cbc40 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="a2cbc40" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-c701a09 ot-flex-column-vertical" data-id="c701a09" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-f5c1e92 elementor-widget elementor-widget-text-editor" data-id="f5c1e92" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><strong>建议</strong></p><ol><li class="translated">设置一个JVM分析器来密切监视您的Solr和Zookeeper节点，特别注意垃圾收集周期和一般的内存使用情况:您不希望Zk交换太多！(GC viewer<a href="https://web.archive.org/web/20230226232125/https://github.com/chewiebug/GCViewer" target="_blank" rel="noopener">【3】</a>可能是一个很好的工具)</li><li class="translated">验证Zookeeper节点可以快速写入磁盘:Zookeeper需要快速写入，最好分配一个单独的磁盘。</li><li class="translated">监控您的网络，确保solr节点可以有效地与Zookeeper节点通信</li></ol><p class="translated">如果这些建议没有解决您的问题，您可能遇到了Solr bug。<br/>其中一个是<a href="https://web.archive.org/web/20230226232125/https://issues.apache.org/jira/browse/SOLR-8868" target="_blank" rel="noopener">【4】</a>，不幸的是还没有修复。</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-8a1b248 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="8a1b248" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-b082600 ot-flex-column-vertical" data-id="b082600" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-fd4c998 elementor-widget elementor-widget-iheading" data-id="fd4c998" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h2 class="main-heading translated">org . Apache . Solr . client . solrj . SolrServersexception:<br/>没有可用的活动solrserver来处理这个问题</h2>	    </div>
	    		</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-c6ae307 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="c6ae307" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-5d9c894 ot-flex-column-vertical" data-id="5d9c894" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-688559e elementor-widget elementor-widget-text-editor" data-id="688559e" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">来自官方JavaDoc:</p><p class="translated"><strong><em>org/Apache/Solr/client/solrj/impl/lbhttpsolrclient . Java:369</em></strong><br/>"尝试从Req中提供的列表中查询实时服务器。将跳过死池中的服务器。<br/> *如果请求因IOException而失败，服务器将被移至死池一段时间<br/> *或直到该服务器上的测试请求成功。<br/> * <br/> *按照给定的顺序查询服务器(跳过当前在死池中的服务器除外)。<br/> *如果所提供的列表中没有剩余的活动服务器需要尝试，将会尝试许多之前跳过的失效服务器。<br/>* req . getnumdeadserverstory()控制将尝试多少个失效的服务器。<br/> * <br/> *如果没有找到活动服务器，将引发SolrServerException。</p><p class="translated">异常发生时集群的状态是什么？根据Zookeeper的知识，有任何Solr服务器启动并运行吗？</p><p class="translated">建议在异常发生时检查clusterstate.json。<br/>从Solr admin UI中，您可以打开Cloud- &gt;树并验证哪些节点已启动并正在运行。</p><p class="translated">这可能与节点故障有很大关系(这可能与任何可能的原因有关，包括GC) <br/>我见过由特定查询引起的情况，真正的异常被“没有活动的SolrServers…”客户端异常所隐藏。Solr日志应该有助于识别内部Solr问题，JVM监控可以丢弃任何内存/gc问题。<br/>有些人通过通配符查询看到了这一点(当每个分片都报告“太多扩展…”类型错误，但是客户端响应中的异常是“没有活动的SolrServers…”)。</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-dabfb6a ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="dabfb6a" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-7ce387c ot-flex-column-vertical" data-id="7ce387c" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-482cefd elementor-widget elementor-widget-iheading" data-id="482cefd" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h2 class="main-heading translated">org . Apache . Solr . common . sol rexception:<br/>找不到健康的节点来处理请求</h2>	    </div>
	    		</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-8503a11 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="8503a11" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-d963765 ot-flex-column-vertical" data-id="d963765" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-d583f11 elementor-widget elementor-widget-text-editor" data-id="d583f11" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">与“没有实时Solr服务器”的考虑差不多。当负载平衡器SolrJ端无法从集群中检索到活动节点时，会发生这种情况(基于Zookeeper状态)。<br/>这发生在前一个异常之前，所以请求甚至没有到达LoadBalancinghttpSolrClient。</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-2aaee3db ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="2aaee3db" data-element_type="section" data-settings="{&quot;background_background&quot;:&quot;classic&quot;}">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-19cbc0ed ot-flex-column-vertical" data-id="19cbc0ed" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-317b330c elementor-widget elementor-widget-iheading" data-id="317b330c" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>// our service</span>
	        <h2 class="main-heading translated">不要脸的塞给我们培训和服务！</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-16b36149 elementor-widget elementor-widget-text-editor" data-id="16b36149" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">我提到过我们做<a href="https://web.archive.org/web/20230226232125/https://sease.io/training/apache-solr-training/apache-solr-beginner-training"> Apache Solr初学者</a>和<a href="https://web.archive.org/web/20230226232125/https://sease.io/training/elasticsearch-trainings/elasticsearch-beginner-training"> Elasticsearch初学者</a>培训吗？<br/>我们还提供关于这些主题的咨询，<a href="https://web.archive.org/web/20230226232125/https://sease.io/contacts">如果您想让您的搜索引擎更上一层楼，请联系</a>！</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-9a7889a ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="9a7889a" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-37e09574 ot-flex-column-vertical" data-id="37e09574" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-35732e6e elementor-widget elementor-widget-iheading" data-id="35732e6e" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>// STAY ALWAYS UP TO DATE</span>
	        <h2 class="main-heading translated">订阅我们的时事通讯</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-4eb96985 elementor-widget elementor-widget-text-editor" data-id="4eb96985" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">你喜欢这篇关于Apache Zookeeper的SolrCloud异常的帖子吗？不要忘记订阅我们的时事通讯，以便随时了解信息检索世界的最新动态！</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-18adc4ac elementor-widget elementor-widget-wp-widget-mc4wp_form_widget" data-id="18adc4ac" data-element_type="widget" data-widget_type="wp-widget-mc4wp_form_widget.default">
				<div class="elementor-widget-container">
			<script>(function() {
	window.mc4wp = window.mc4wp || {
		listeners: [],
		forms: {
			on: function(evt, cb) {
				window.mc4wp.listeners.push(
					{
						event   : evt,
						callback: cb
					}
				);
			}
		}
	}
})();
</script><!-- Mailchimp for WordPress v4.9.1 - https://wordpress.org/plugins/mailchimp-for-wp/ --><form id="mc4wp-form-1" class="mc4wp-form mc4wp-form-1343" method="post" data-id="1343" data-name="Sease Mailchimp"><div class="mc4wp-form-fields">
<div class="subscribe-inner-form">
	<input type="email" name="EMAIL" placeholder="Your Email" required=""/>
	<button type="submit" class="subscribe-btn-icon"><i class="flaticon-telegram"/></button>
</div>	

<p class="translated"><label> <input name="AGREE_TO_TERMS" type="checkbox" value="1" required=""/> <a href="https://web.archive.org/web/20230226232125/https://sease.io/privacy-policy" target="_blank">我已经阅读并同意隐私政策</a> </label></p></div><label style="display: none !important;">Leave this field empty if you're human: <input type="text" name="_mc4wp_honeypot" value="" tabindex="-1" autocomplete="off"/></label><input type="hidden" name="_mc4wp_timestamp" value="1677453686"/><input type="hidden" name="_mc4wp_form_id" value="1343"/><input type="hidden" name="_mc4wp_form_element_id" value="mc4wp-form-1"/><div class="mc4wp-response"/></form><!-- / Mailchimp for WordPress Plugin -->		</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
									    
</body>
</html>