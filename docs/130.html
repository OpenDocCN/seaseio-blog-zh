<html>
<head>
<title>Vespa Neural Search Tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vespa神经搜索教程</h1>
<blockquote>原文：<a href="https://web.archive.org/web/sease.io/2023/02/vespa-neural-search-tutorial.html#0001-01-01">https://web.archive.org/web/sease.io/2023/02/vespa-neural-search-tutorial.html#0001-01-01</a></blockquote>
									<section class="elementor-section elementor-top-section elementor-element elementor-element-6c27388 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="6c27388" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-670c208 ot-flex-column-vertical" data-id="670c208" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-a5dfbef elementor-widget elementor-widget-text-editor" data-id="a5dfbef" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">嗨读者们！<br/>在这篇博文中，我们将通过一个端到端的教程来探索如何在Vespa 中进行<strong>神经搜索。</strong></p>
<p class="translated">通过实例，我们将了解如何:</p>
<ul>
<li class="translated"><strong>准备合适的文件</strong></li>
<li class="translated"><strong>导出合适的神经模型</strong>并在Vespa中使用</li>
<li class="translated"><strong>为神经搜索配置Vespa】</strong></li>
<li class="translated"><strong>运行最近邻查询</strong>，将它们与过滤器和文本搜索相结合</li>
</ul>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-2b920b5 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="2b920b5" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-538309b ot-flex-column-vertical" data-id="538309b" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-d7d47d0 elementor-widget elementor-widget-iheading" data-id="d7d47d0" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h2 class="main-heading translated">1.下载Vespa</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-f694c96 elementor-widget elementor-widget-text-editor" data-id="f694c96" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">为了保持一切简单，我们使用一个<strong>最小本地Vespa </strong>。<br/>为了安装它，我们遵循<strong> Vespa <a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/vespa-quick-start.html">快速启动</a>指南</strong>。如官方文件所述，在继续之前，<strong>请确保符合所有先决条件</strong>。</p>
<p class="translated">安装Vespa: <br/> <code>brew install vespa-cli</code></p>
<p class="translated">对于我们的教程，我们创建一个具有以下结构的项目:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-fa5638e elementor-widget elementor-widget-image" data-id="fa5638e" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
								<div class="elementor-image">
												<img data-attachment-id="57207" data-permalink="https://web.archive.org/web/20230314041044/https://sease.io/2023/02/vespa-neural-search-tutorial.html/imgonline-com-ua-replacecolor-jdllq9pbml" data-orig-file="https://web.archive.org/web/20230314041044/https://i0.wp.com/sease.io/wp-content/uploads/2023/01/imgonline-com-ua-ReplaceColor-jdLlQ9PbMl.jpg?fit=507%2C344&amp;ssl=1" data-orig-size="507,344" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="imgonline-com-ua-ReplaceColor-jdLlQ9PbMl" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20230314041044/https://i0.wp.com/sease.io/wp-content/uploads/2023/01/imgonline-com-ua-ReplaceColor-jdLlQ9PbMl.jpg?fit=300%2C204&amp;ssl=1" data-large-file="https://web.archive.org/web/20230314041044/https://i0.wp.com/sease.io/wp-content/uploads/2023/01/imgonline-com-ua-ReplaceColor-jdLlQ9PbMl.jpg?fit=507%2C344&amp;ssl=1" decoding="async" width="507" height="344" src="../Images/6e2a44eb03daefa075d20f8c5dea30fa.png" class="attachment-full size-full wp-image-57207" alt="" loading="lazy" srcset="https://web.archive.org/web/20230314041044im_/https://i0.wp.com/sease.io/wp-content/uploads/2023/01/imgonline-com-ua-ReplaceColor-jdLlQ9PbMl.jpg?w=507&amp;ssl=1 507w, https://web.archive.org/web/20230314041044im_/https://i0.wp.com/sease.io/wp-content/uploads/2023/01/imgonline-com-ua-ReplaceColor-jdLlQ9PbMl.jpg?resize=300%2C204&amp;ssl=1 300w" sizes="(max-width: 507px) 100vw, 507px" data-original-src="https://web.archive.org/web/20230314041044im_/https://i0.wp.com/sease.io/wp-content/uploads/2023/01/imgonline-com-ua-ReplaceColor-jdLlQ9PbMl.jpg?fit=507%2C344&amp;ssl=1"/>														</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-8d63d88 elementor-widget elementor-widget-text-editor" data-id="8d63d88" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<ul>
<li style="list-style-type: none;">
 
<ul>
<li class="translated"><em> documents </em>文件夹将包含python脚本，用于将MSMarco数据转换为适用于Vespa的文档格式，以及包含输入(<em> msmarco_documents </em>)和输出(<em> vespa_documents </em>)文件的两个文件夹。</li>
</ul>
</li>
</ul>
<ul>
<li style="list-style-type: none;">
 
<ul>
<li class="translated"><em> model </em>文件夹将包含从HuggingFace导出句子转换器并将其转换为适合Vespa的ONNX格式的python脚本，以及包含必要模型文件(模型和词汇)的<em>文件</em>。</li>
</ul>
</li>
</ul>
<ul>
<li style="list-style-type: none;">
 
<ul>
<li class="translated"><em>模式</em>文件夹将包含文档模式文件。</li>
</ul>
</li>
</ul>
<ul>
<li style="list-style-type: none;">
 
<ul>
<li class="translated"><em> service.xml </em>将定义Vespa配置和组件。</li>
</ul>
</li>
</ul>
<ul>
<li style="list-style-type: none;">
 
<ul>
<li class="translated">用于将文档输入vespa的<em> vespa-feed-client </em>工具。</li>
</ul>
</li>
</ul>
<p class="translated">所有的材料都可以在我们的GitHub资源库中找到:<br/><a href="https://web.archive.org/web/20230314041044/https://github.com/SeaseLtd/vespa-neural-search-tutorial">https://github.com/SeaseLtd/vespa-neural-search-tutorial</a></p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-c80d895 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="c80d895" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-5d46183 ot-flex-column-vertical" data-id="5d46183" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-b68a51d elementor-widget elementor-widget-iheading" data-id="b68a51d" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h2 class="main-heading translated">2.准备文件</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-df4716b elementor-widget elementor-widget-text-editor" data-id="df4716b" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">现在我们已经安装了Vespa，让我们开始创建我们的文档。</p>
<p class="translated">对于本教程，我们采用一个语料库<a href="https://web.archive.org/web/20230314041044/https://microsoft.github.io/msmarco/"><strong>MARCO女士</strong> </a>，这是一个用于深度学习的大规模信息检索数据集的集合。具体来说，我们下载<strong>短文检索集</strong>:<a href="https://web.archive.org/web/20230314041044/https://msmarco.blob.core.windows.net/msmarcoranking/collection.tar.gz">collection.tar.gz</a>并提取其中的<strong>前10k个文档</strong>。然后我们把这个文件放在<em> msmarco_documents </em>文件夹中，命名为<em> documents_10k.tsv </em>。</p>
<p class="translated">为了在Vespa中推送MS Marco数据，我们需要对其进行操作，并使用Vespa支持的格式创建文档。为此，我们使用<em>文档</em>文件夹中的<em><strong>convert _ ms Marco _ data _ to _ vespa _ format . py</strong></em>python脚本。</p>
<p class="translated">为了保持一个清晰的环境，我们在<a href="https://web.archive.org/web/20230314041044/https://www.anaconda.com/products/distribution"> Anaconda </a>中安装了所有的依赖项。<br/>让我们首先创建一个<em> conda </em>环境来管理必要的库:<br/> <code>conda create -n vespa_tutorial_env python=3.10 &amp;&amp; conda activate vespa_tutorial_env</code></p>
<p class="translated">现在我们已经准备好生成文档了。下面是要使用的脚本:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-a20ebee elementor-widget elementor-widget-text-editor" data-id="a20ebee" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- /wp:paragraph --> <!-- wp:code --></p>
<pre class="wp-block-code"><code>import random

if __name__ == "__main__":
    <strong>fields_list = ["id", "text", "color"]</strong>
    categorical_list = ["yellow", "red", "blue", "green", "white", "black", "pink", "orange"]

    <strong>input_file</strong> = open("<strong>./msmarco_documents/documents_10k.tsv</strong>", "r")
    <strong>output_file</strong> = open("<strong>./vespa_documents/collection_for_feeding.json</strong>", "w")
    document = ""
    count = 1
    for line in input_file.readlines():
        text = line.split("\t")[1]
        categorical_value = random.randint(0, 7)
        document = document + "{\"put\": \"<strong>id</strong>:doc:doc::" + str(count) + "\","
        document = document + "\"<strong>fields</strong>\": {\"<strong>text</strong>\": \"" + text.replace("\\d", "d").replace("\\", "")[:-1] + "\","
        document = document + "\"<strong>color</strong>\": \"" + categorical_list[categorical_value] + "\"}"
        document = document + "}\n"
        count = count + 1
    output_file.write(document)
    output_file.close()
    input_file.close()</code></pre>
<p class="translated"><!-- /wp:code -->T12】</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-424f94a elementor-widget elementor-widget-text-editor" data-id="424f94a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">其中:</p>
<ol>
<li class="translated"><em>。/ms Marco _ documents/documents _ 10k . tsv</em>是<strong>输入文件</strong>的路径，从中获取文档。<br/> <br/></li>
<li class="translated"><em>。/vespa _ documents/collection _ for _ feeding . JSON</em>是<strong>输出文件</strong>的路径，在这里写入生成的Vespa文档。</li>
</ol>
<p class="translated">然后，让我们使用以下命令执行该脚本:</p>
<p class="translated"><code>cd documents</code> <br/> <code>python convert_msmarco_data_to_vespa_format.py</code></p>
<p class="translated">我们创建的每个文档都包含:</p>
<ol>
<li class="translated">一个增量<strong> id </strong>(从1开始)<br/> <br/></li>
<li class="translated">包含MS Marco文档<br/> <br/>文本的<strong>文本</strong>字段</li>
<li class="translated">添加了一个随机的<strong>颜色</strong>字段，只是为了展示过滤查询如何与神经搜索一起工作</li>
</ol>
<p class="translated"><em> vespa_documents </em>输出文件夹中最终生成的文件(<em>collection _ for _ feeding . JSON</em>)如下图所示:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-737602e elementor-widget elementor-widget-text-editor" data-id="737602e" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- /wp:paragraph --></p>
<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>{
	"put": "id:doc:doc::1",
	"fields": {
		"text": "The presence of communication amid scientific minds was equally important to the success of the Manhattan Project as scientific intellect was...",
		"color": "yellow"
	}
} {
	"put": "id:doc:doc::2",
	"fields": {
		"text": "The Manhattan Project and its atomic bomb helped bring an end to World War II. Its legacy of peaceful uses of atomic energy continues to have an impact on history and science.",
		"color": "pink"
	}
} {
	"put": "id:doc:doc::3",
	"fields": {
		"text": "Essay on The Manhattan Project - The Manhattan Project The Manhattan Project was ...",
		"color": "red"
	}
}</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-4923b08 elementor-widget elementor-widget-text-editor" data-id="4923b08" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">这是使用我们稍后将使用的<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/vespa-feed-client.html"> vespa-feed-client </a>工具输入文档时所需的<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/document-json-format.html#document-operations">文档JSON格式</a>。</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-e0b28d4 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="e0b28d4" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-0c9f174 ot-flex-column-vertical" data-id="0c9f174" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-a24cd9f elementor-widget elementor-widget-iheading" data-id="a24cd9f" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h2 class="main-heading translated">3.导出神经模型</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-c9eb575 elementor-widget elementor-widget-text-editor" data-id="c9eb575" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">现在我们有了文件，我们可以专注于准备神经模型。<br/>首先，我们需要下载想要的型号。</p>
<p class="translated">对于本教程，我们使用来自HuggingFace 的<strong> <a href="https://web.archive.org/web/20230314041044/https://huggingface.co/sentence-transformers/all-MiniLM-L6-v2"> all-MiniLM-L6-v2 </a>句子转换器</strong> <strong>。它是一个大约90MB的<strong> BERT </strong>型号，具有384的<em>hidden _ size</em>(<em>embedding _ dimension</em>)。</strong></p>
<p class="translated">我们可以直接下载词汇表(<em> <a href="https://web.archive.org/web/20230314041044/https://huggingface.co/sentence-transformers/all-MiniLM-L6-v2/blob/main/vocab.txt"> vocab.txt </a> </em>文件)，而对于型号我们需要转换它，因为<strong> Vespa只支持<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/onnx.html"> ONNX型号格式</a> </strong>。</p>
<p class="translated">为了做到这一点，我们使用了一个需要<a href="https://web.archive.org/web/20230314041044/https://pytorch.org/"> PyTorch </a>和<a href="https://web.archive.org/web/20230314041044/https://huggingface.co/docs/transformers/installation">变形金刚</a>hugging face库的python脚本。<br/>安装它:<br/> <code>pip install torch</code> <br/> <code>pip install transformers</code></p>
<p class="translated">现在我们准备转换模型。<br/>我们执行的文件是<em><strong><a href="https://web.archive.org/web/20230314041044/https://github.com/SeaseLtd/vespa-neural-search-tutorial/blob/main/model/export_model.py">export _ model . py</a></strong></em>。这摘自Vespa <a href="https://web.archive.org/web/20230314041044/https://github.com/vespa-engine/sample-apps/blob/a7f555fdb943a4a42a723f56664dec2fe1252f1e/simple-semantic-search/">简单语义搜索</a> GitHub示例，特别是<a href="https://web.archive.org/web/20230314041044/https://github.com/vespa-engine/sample-apps/blob/a7f555fdb943a4a42a723f56664dec2fe1252f1e/simple-semantic-search/export_model_from_hf.py">export _ model _ from _ HF . py</a>文件:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-486a3f5 elementor-widget elementor-widget-text-editor" data-id="486a3f5" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- /wp:paragraph --></p>
<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code># Copyright Yahoo. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.
from transformers import BertModel
import torch

encoder = BertModel.from_pretrained("<strong>sentence-transformers/all-MiniLM-L6-v2</strong>")

# Vespa bert embedder expects these inputs and outputs
# Vespa implements the pooling, default average
input_names = ["input_ids", "attention_mask", "token_type_ids"]
output_names = ["output_0"]

input_ids = torch.ones(1,32, dtype=torch.int64)
attention_mask = torch.ones(1,32,dtype=torch.int64)
token_type_ids = torch.zeros(1,32,dtype=torch.int64)
args = (input_ids, attention_mask, token_type_ids)
<strong>torch.onnx.export</strong>(encoder,
  args=args,
  f="<strong>./files/minilm-l6-v2.onnx</strong>",
  do_constant_folding=True,
  input_names = input_names,
  output_names = output_names,
  dynamic_axes = {
    "input_ids": {0: "batch", 1:"batch"},
    "attention_mask": {0: "batch", 1: "batch"},
    "token_type_ids": {0: "batch", 1: "batch"},
    "output_0": {0: "batch"},
  },
  opset_version=14)</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-0e13a4a elementor-widget elementor-widget-text-editor" data-id="0e13a4a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">这个脚本从HuggingFace下载<em>句子-变形金刚/all-MiniLM-L6-v2 </em>模型并导出到一个文件(<em>)。/files/minilm-l6-v2.onnx </em>)与正确的onnx格式。</p>
<p class="translated">让我们用下面的代码来执行它:</p>
					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-b8cf61d elementor-widget elementor-widget-text-editor" data-id="b8cf61d" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>cd model
python export_model.py</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-c97cea5 elementor-widget elementor-widget-text-editor" data-id="c97cea5" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">我们现在可以停用我们的<em> conda </em>环境，因为我们不再需要它了:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-9ac20e7 elementor-widget elementor-widget-text-editor" data-id="9ac20e7" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>conda deactivate</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-aa2ee05 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="aa2ee05" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-bacfb91 ot-flex-column-vertical" data-id="bacfb91" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-d357ca9 elementor-widget elementor-widget-iheading" data-id="d357ca9" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h2 class="main-heading translated">4.配置Vespa</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-1cb74b4 elementor-widget elementor-widget-iheading" data-id="1cb74b4" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h3 class="main-heading translated">4.1服务</h3>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-fc23170 elementor-widget elementor-widget-text-editor" data-id="fc23170" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">现在让我们在Vespa应用程序中定义<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/tutorials/news-2-basic-feeding-and-query.html#services-specification">服务</a>。这里我们不会太详细，因为我们基本上保持默认配置。</p>
<p class="translated">下面是我们创建的<em> services.xml </em>文件:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-ef72b2a elementor-widget elementor-widget-text-editor" data-id="ef72b2a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<pre class="wp-block-code"><code>&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;services version="1.0" xmlns:deploy="vespa" xmlns:preprocess="properties"&gt;

    &lt;!-- See https://docs.vespa.ai/en/reference/services-container.html --&gt;
    &lt;container id="default" version="1.0"&gt;

        &lt;!-- See https://docs.vespa.ai/en/embedding.html#bertbase-embedder --&gt;
        <strong>&lt;component id="bert" class="ai.vespa.embedding.BertBaseEmbedder" bundle="model-integration"&gt;
            &lt;config name="embedding.bert-base-embedder"&gt;
                &lt;transformerModel path="model/files/minilm-l6-v2.onnx"/&gt;
                &lt;tokenizerVocab path="model/files/vocab.txt"/&gt;
            &lt;/config&gt;
        &lt;/component&gt;</strong>

        &lt;document-api/&gt;
        &lt;search/&gt;

        &lt;nodes&gt;
            &lt;node hostalias="node1" /&gt;
        &lt;/nodes&gt;
    &lt;/container&gt;

    &lt;!-- See https://docs.vespa.ai/en/reference/services-content.html --&gt;
    &lt;content id="text" version="1.0"&gt;
        &lt;redundancy&gt;2&lt;/redundancy&gt;
        &lt;documents&gt;
            &lt;document type="doc" mode="index" /&gt;
        &lt;/documents&gt;
        &lt;nodes&gt;
            &lt;node hostalias="node1" distribution-key="0" /&gt;
        &lt;/nodes&gt;
    &lt;/content&gt;

&lt;/services&gt;</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-923b2db elementor-widget elementor-widget-text-editor" data-id="923b2db" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">让我们来关注一下<strong> <a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/embedding.html">嵌入</a>组件</strong>:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-36bfaeb elementor-widget elementor-widget-text-editor" data-id="36bfaeb" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>&lt;component id="bert" class="ai.vespa.embedding.BertBaseEmbedder" bundle="model-integration"&gt;
    &lt;config name="embedding.bert-base-embedder"&gt;
        &lt;<strong>transformerModel path</strong>="model/files/<strong>minilm-l6-v2.onnx</strong>"/&gt;
        &lt;<strong>tokenizerVocab path</strong>="model/files/<strong>vocab.txt</strong>"/&gt;
    &lt;/config&gt;
&lt;/component&gt;</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-252ac07 elementor-widget elementor-widget-text-editor" data-id="252ac07" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">这是我们用来从文本中创建向量的模型，具体来说，我们利用了Vespa的<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/embedding.html#bertbase-embedder"> BertBaseEmbedder </a>组件。唯一需要注意的是<em> transformerModel </em>和<em> tokenizerVocab </em>路径，它们应该指向我们想要使用的模型和词汇文件。</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-f02da71 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="f02da71" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-d18a660 ot-flex-column-vertical" data-id="d18a660" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-46745c1 elementor-widget elementor-widget-iheading" data-id="46745c1" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h3 class="main-heading translated">4.2模式</h3>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-530bcef elementor-widget elementor-widget-text-editor" data-id="530bcef" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">最后，我们可以为我们的神经搜索定义Vespa <a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/schemas.html">模式</a>(<em>模式</em>文件夹中的<em> doc.sd </em>文件)。这个文件包含我们的文档的字段定义和我们将在查询时使用的排名配置文件。</p>
<p class="translated">让我们看看它是什么样子的，并详细探索每个部分。<br/><em><strong>doc . SD</strong></em>文件:<a href="https://web.archive.org/web/20230314041044/https://github.com/SeaseLtd/vespa-neural-search-tutorial/blob/main/schemas/doc.sd">https://github . com/SeaseLtd/vespa-neural-search-tutorial/blob/main/schemas/doc . SD</a></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-980e956 elementor-widget elementor-widget-iheading" data-id="980e956" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h4 class="main-heading translated">字段定义</h4>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-731e851 elementor-widget elementor-widget-text-editor" data-id="731e851" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">让我们从字段定义开始:</p>
<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code><strong>document</strong> doc {
    # Field that contains MSMarco document's text
    <strong>field</strong> <strong>text</strong> type string {
        indexing: summary | index
        index: enable-bm25
    }

    # Field that contains our random color
    <strong>field</strong> <strong>color</strong> type string {
        indexing: summary | index
        rank: filter
    }

}

# Field that contains the vector(extracted from text)
<strong>field embedding</strong> type tensor&lt;float&gt;(x[384]) {
    indexing: input text | embed bert | attribute | index
    attribute {
        distance-metric: euclidean
    }
    index: hnsw
}</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-18576d5 elementor-widget elementor-widget-text-editor" data-id="18576d5" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">这里我们定义了三个字段:</p>
<ol>
<li class="translated"><strong> Text </strong>:包含每个文档的MS Marco文本。<br/>T12】</li>
<li class="translated"><strong>颜色</strong>:包含我们在文件准备步骤中分配给每个文件的随机颜色。<br/> <br/></li>
<li class="translated"><strong>嵌入</strong>:它将包含表示文本字段中相应文本的数值向量。这里我们定义了一个张量&lt; float &gt;，其维数为384，对应于我们的神经模型的输出。该字段有三个参数集:索引、属性和索引。</li>
</ol>
<p class="translated">让我们更详细地看看嵌入参数。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-f3b00a3 elementor-widget elementor-widget-iheading" data-id="f3b00a3" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h6 class="main-heading translated">索引</h6>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-653c9ed elementor-widget elementor-widget-text-editor" data-id="653c9ed" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">正如Vespa <a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/schemas.html#indexing">文档</a> : <em>中所述，“索引指令的流水线语义类似于Unix shell命令，数据从左向右流动。它们可以对字段值执行复杂的转换，或者只是将字段值原封不动地发送到索引结构的下一部分。”</em>。</p>
<p class="translated">在我们的例子中,<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/embedding.html#embedding-a-document-field">管道</a>是:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-b6d64e5 elementor-widget elementor-widget-text-editor" data-id="b6d64e5" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>input text | embed bert | attribute | index</code></pre>
<p class="translated"><!-- /wp:paragraph --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-a30d513 elementor-widget elementor-widget-text-editor" data-id="a30d513" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">这里，<em>文本</em>字段的内容被用作嵌入生成的输入。向量通过<em> bert </em>嵌入器(在<em> services.xml </em>文件中定义的嵌入器的id)创建，然后作为内存中的属性添加。最后是索引。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-4a6e142 elementor-widget elementor-widget-iheading" data-id="4a6e142" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h6 class="main-heading translated">属性</h6>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-e641e36 elementor-widget elementor-widget-text-editor" data-id="e641e36" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">如Vespa <a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/schema-reference.html#attribute">文档</a>中所述:<em>属性包含在<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/schema-reference.html#field">字段</a>或<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/schema-reference.html#struct-field">结构字段</a>中。指定索引结构特性的属性。</em>。<br/>当我们定义<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/schema-reference.html#distance-metric">距离度量</a>与<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/query-language-reference.html#nearestneighbor">最近邻</a>查询操作符一起使用时，这是必要的，在我们的例子中是欧几里德距离。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-9ef9ed5 elementor-widget elementor-widget-iheading" data-id="9ef9ed5" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h6 class="main-heading translated">索引</h6>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-4b8b7ec elementor-widget elementor-widget-text-editor" data-id="4b8b7ec" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">如Vespa <a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/schema-reference.html#attribute">文档</a>中所述:<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/schema-reference.html#field">字段</a>或<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/schema-reference.html#struct-field">结构字段</a>中包含的<em>属性。指定索引结构特性的属性。</em>。<br/>当我们定义与<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/query-language-reference.html#nearestneighbor">最近邻</a>查询操作符一起使用的<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/schema-reference.html#distance-metric">距离度量</a>时，这是必要的，在我们的例子中是欧几里德距离。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-b4a43d3 elementor-widget elementor-widget-iheading" data-id="b4a43d3" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h4 class="main-heading translated">等级配置文件</h4>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-30bca28 elementor-widget elementor-widget-text-editor" data-id="30bca28" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">在Vespa中，<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/ranking.html#rank-profiles">等级配置文件</a>用于定义在查询时可以选择的等级表达式功能和设置。不同的简档可以具有不同的相关性表达、不同的度量和排名行为；允许在输入中使用不同的查询功能。</p>
<p class="translated">我们的第一个<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/ranking.html#rank-profiles">等级档案</a>是<em>纯_神经_等级</em>档案。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-38c9054 elementor-widget elementor-widget-iheading" data-id="38c9054" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h6 class="main-heading translated">纯神经等级轮廓</h6>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-83f4f4f elementor-widget elementor-widget-text-editor" data-id="83f4f4f" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code># Rank profile that implements a pure Neural Search
<strong>rank-profile pure_neural_rank</strong> {
    num-threads-per-search: 1

    inputs {
        query(first_query) tensor&lt;float&gt;(x[384])
        query(second_query) tensor&lt;float&gt;(x[384])
    }
    first-phase {
        expression: closeness(field, embedding)
    }
    match-features {
        closeness(field, embedding)
        closeness(label, first_query) 
        closeness(label, second_query)
        distance(field,embedding)
    }

}</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-2d355da elementor-widget elementor-widget-text-editor" data-id="2d355da" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><strong>该配置文件的目的是执行纯粹的最近邻搜索。在查询时接受一两个嵌入并返回最近的文档。</strong></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-0a89810 elementor-widget elementor-widget-text-editor" data-id="0a89810" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">这里我们定义了三个<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/schema-reference.html#rank-profile">元素</a>:</p>
<ul>
<li class="translated"><a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/schema-reference.html#inputs">输入</a>:查询该档案中排名表达式消耗的特征。<br/> <br/></li>
<li class="translated"><a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/schema-reference.html#firstphase-rank">第一阶段</a>:排位<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/phased-ranking.html">第一阶段</a>使用的排位配置。<br/> <br/></li>
<li class="translated"><a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/schema-reference.html#match-features">匹配特征</a>:在<em>匹配</em>阶段计算的<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/rank-features.html">等级特征</a>将随每次命中返回。</li>
</ul>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-c8ef375 elementor-widget elementor-widget-text-editor" data-id="c8ef375" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><strong>输入</strong></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-ab78b87 elementor-widget elementor-widget-text-editor" data-id="ab78b87" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">对于神经搜索，我们定义了在查询中传递两个张量的可能性:<code>query(first_query)</code>和<code>query(second_query)</code>。两者都是由我们的<em> bert </em>嵌入器在查询时生成的张量。这些向量在<code>inputs.query()</code>查询参数中传递，如:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-888a94a elementor-widget elementor-widget-text-editor" data-id="888a94a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>input.query(first_query)=embed(#of calories to eat to lose weight)</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-b12a083 elementor-widget elementor-widget-text-editor" data-id="b12a083" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">其中<code>embed()</code>是调用我们的<em> bert </em>嵌入器从文本创建向量的函数。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-b641c64 elementor-widget elementor-widget-text-editor" data-id="b641c64" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><strong>第一阶段</strong></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-e08695b elementor-widget elementor-widget-text-editor" data-id="e08695b" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">这里我们定义了相关性计算的表达式。<br/> Vespa支持多等级阶段。对于本教程，我们只是设定了一期排名，但如果你有兴趣，更多详情可以在这里<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/phased-ranking.html">找到</a>。</p>
<p class="translated">我们选择<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/rank-features.html#attribute-match-features-normalized">接近度</a>作为度量，它与<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/query-language-reference.html#nearestneighbor">最近邻</a>查询操作符一起使用。该指标在内部使用模式的<em>嵌入</em>字段中定义的<em>距离</em>。</p>
<p class="translated">当一个通用的<code>closeness(field, embedding)</code>表达式被用于传递两个查询张量时，文档相关性将是为每个向量计算的那些之间的最大接近度。因此:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-40809f1 elementor-widget elementor-widget-text-editor" data-id="40809f1" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>max{closeness(label, first_query), closeness(label, second_query)}</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-a986768 elementor-widget elementor-widget-text-editor" data-id="a986768" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><strong>匹配特征</strong></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-76e692f elementor-widget elementor-widget-text-editor" data-id="76e692f" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">在<em>匹配特征</em>中，我们可以定义想要在结果中监控的有用指标。这确实是每个结果命中要包括的等级特征的列表。</p>
<p class="translated">出于本教程的目的，我们将展示:</p>
<ul>
<li class="translated"><code>closeness(field, embedding)</code>最终文档紧密度(之前解释的最大紧密度)。<br/> <br/></li>
<li class="translated"><code>closeness(label, first_query)</code>文档与第一个查询向量的接近度。<br/> <br/></li>
<li class="translated"><code>closeness(label, second_query)</code>文档和第二查询向量之间的接近度。</li>
</ul>
<p class="translated">为了显示两个不同向量的接近程度，我们使用了<strong>查询注释</strong>，特别是<strong>标签</strong>。<br/>这些是在查询时在<em>最近邻</em>方法中定义的，并且唯一地标识向量。例如，对于第一个张量，我们可以定义:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-2bf86e1 elementor-widget elementor-widget-text-editor" data-id="2bf86e1" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- /wp:paragraph --></p>
<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>{<strong>label:'first_query'</strong>, targetHits:100}nearestNeighbor(embedding, first_query)</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-0215953 elementor-widget elementor-widget-text-editor" data-id="0215953" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">我们将在查询示例中看到真实的用法；文档中的更多信息可在<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/nearest-neighbor-search-guide.html#multiple-nearest-neighbor-search-operators-in-the-same-query">这里</a>找到。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-b63211a elementor-widget elementor-widget-iheading" data-id="b63211a" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h6 class="main-heading translated">混合等级</h6>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-bc0c167 elementor-widget elementor-widget-text-editor" data-id="bc0c167" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">让我们看看第二个侧面:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-246299f elementor-widget elementor-widget-text-editor" data-id="246299f" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code># Rank profile that implements a combination of Neural and Textual Search
<strong>rank-profile hybrid_rank inherits pure_neural_rank</strong> {
    inputs {
        query(textWeight) : 1.0
        query(vectorWeight) : 1.0
    }
    first-phase {
        expression {
            query(textWeight) * bm25(text) +
            query(vectorWeight) * closeness(field, embedding)
        }
    }
    match-features {
        closeness(field, embedding)
        bm25(text)
    }
}</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-d759127 elementor-widget elementor-widget-text-editor" data-id="d759127" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">在这里，我们希望<strong>计算一个更复杂的相关性，同时考虑词汇排名(用<em> bm25 </em>)和神经排名(用<em>接近度</em> ) </strong>。该配置文件继承了<em> pure_neural_rank </em>配置文件，因此我们首先读取张量并计算<em> pure_neural_rank </em>中的接近度，然后我们找到与新公式的最终相关性。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-6c67542 elementor-widget elementor-widget-text-editor" data-id="6c67542" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><strong>输入</strong></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-a8be0d1 elementor-widget elementor-widget-text-editor" data-id="a8be0d1" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">当<em>为这个概要文件输入</em>时，我们定义了两个<strong>权重</strong>:一个用于<em>文本</em>相关性，一个用于<em>向量</em>相关性。它们用于第一阶段排名表达式。如果没有传递值，则分配默认的1权重。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-0dfd7b7 elementor-widget elementor-widget-text-editor" data-id="0dfd7b7" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><strong>一期</strong></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-b7d3ccb elementor-widget elementor-widget-text-editor" data-id="b7d3ccb" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">作为相关性公式，我们定义了在文本字段上计算的<em> bm25 </em>得分与在<em> pure_neural_rank </em>简档中计算的接近度之和，乘以它们相应的权重。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-973c53c elementor-widget elementor-widget-text-editor" data-id="973c53c" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><strong>匹配特征</strong></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-207f60e elementor-widget elementor-widget-text-editor" data-id="207f60e" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">最后，我们打印为每个文档命中计算的<em>接近度</em>和<em> bm25 </em>值。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-8a91768 elementor-widget elementor-widget-iheading" data-id="8a91768" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h6 class="main-heading translated">神经秩和贴近度</h6>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-398fd7b elementor-widget elementor-widget-text-editor" data-id="398fd7b" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">让我们看看最后一个侧写。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-abb682d elementor-widget elementor-widget-text-editor" data-id="abb682d" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code># Rank profile that implements a different relevance metric for the pure Neural Search
<strong>rank-profile neural_rank_sum_closeness</strong> {
    num-threads-per-search: 1

    inputs {
        query(first_query) tensor&lt;float&gt;(x[384])
        query(second_query) tensor&lt;float&gt;(x[384])
    }
    first-phase {
        expression: closeness(label, first_query) + closeness(label, second_query)

    }
    match-features {
        distance(field, embedding)
        closeness(field, embedding)
        closeness(label, first_query) 
        closeness(label, second_query)
    }

}</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-0200d11 elementor-widget elementor-widget-text-editor" data-id="0200d11" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">在这个配置文件中，我们希望使用<strong>作为相关性，它是为查询时传递的每个张量</strong>计算的紧密度之和。</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-1d3f287 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="1d3f287" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-6e6090e ot-flex-column-vertical" data-id="6e6090e" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-b76d142 elementor-widget elementor-widget-iheading" data-id="b76d142" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h2 class="main-heading translated">5.索引文档</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-32e6c45 elementor-widget elementor-widget-text-editor" data-id="32e6c45" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">在进行查询之前，我们需要做的最后一件事是将文档推入Vespa。<br/>为了一次馈送多个文档，我们需要<strong>下载并安装<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/vespa-feed-client.html"> vespa-feed-client </a> </strong>。</p>
<p class="translated">我们可以通过以下方式做到这一点:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-33700a0 elementor-widget elementor-widget-text-editor" data-id="33700a0" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>F_REPO="https://repo1.maven.org/maven2/com/yahoo/vespa/vespa-feed-client-cli" &amp;&amp; F_VER=$(curl -Ss "${F_REPO}/maven-metadata.xml" | sed -n 's/.*&lt;release&gt;\(.*\)&lt;.*&gt;/\1/p') &amp;&amp; curl -SsLo vespa-feed-client-cli.zip ${F_REPO}/${F_VER}/vespa-feed-client-cli-${F_VER}-zip.zip &amp;&amp; unzip -o vespa-feed-client-cli.zip</code></pre>
<p class="translated"><!-- /wp:code --></p>
<p class="translated"><!-- wp:paragraph --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-cd4f67a elementor-widget elementor-widget-text-editor" data-id="cd4f67a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">然后，我们用<a href="https://web.archive.org/web/20230314041044/https://www.docker.com/"> docker </a>运行Vespa。确保在<strong>启动Vespa </strong>之前安装好:</p>
					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-2f2aa2e elementor-widget elementor-widget-text-editor" data-id="2f2aa2e" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>vespa config set target local
docker run --detach --name vespa --hostname vespa-container --publish 8080:8080 --publish 19071:19071 vespaengine/vespa
vespa status deploy --wait 300
vespa deploy --wait 300</code></pre>
<p class="translated"><!-- /wp:code --></p>
<p class="translated"><!-- wp:paragraph --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-376dca2 elementor-widget elementor-widget-text-editor" data-id="376dca2" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">和<strong>索引文件</strong>:</p>
					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-d6f09c2 elementor-widget elementor-widget-text-editor" data-id="d6f09c2" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>./vespa-feed-client-cli/vespa-feed-client --file ./documents/vespa_documents/collection_for_feeding.json --endpoint http://localhost:8080</code></pre>
<p class="translated"><!-- /wp:code --></p>
<p class="translated"><!-- wp:heading --></p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-9976876 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="9976876" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-911e7bb ot-flex-column-vertical" data-id="911e7bb" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-bf23e65 elementor-widget elementor-widget-iheading" data-id="bf23e65" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h2 class="main-heading translated">6.问题</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-fee9e2a elementor-widget elementor-widget-text-editor" data-id="fee9e2a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">现在让我们深入到神经搜索查询。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-1a61a55 elementor-widget elementor-widget-iheading" data-id="1a61a55" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h3 class="main-heading translated">6.1精确最近邻搜索</h3>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-86d1b3e elementor-widget elementor-widget-text-editor" data-id="86d1b3e" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">为了利用神经搜索，Vespa提供了<code>nearestNeighbor</code>()方法。它允许我们执行精确和近似的最近邻搜索。</p>
<p class="translated">这是一个执行<strong>精确最近邻搜索</strong> ( <code>approximate:false</code>)的查询示例:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-3bfdde4 elementor-widget elementor-widget-text-editor" data-id="3bfdde4" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>vespa query "yql=select * from doc where {<strong>approximate:false</strong>,targetHits: 100}nearestNeighbor(embedding, first_query)" "input.query(first_query)=embed(#of calories to eat to lose weight)" "ranking=<strong>pure_neural_rank</strong>"</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-da1e638 elementor-widget elementor-widget-iheading" data-id="da1e638" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>RESPONSE</span>
	        	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-af74707 elementor-widget elementor-widget-text-editor" data-id="af74707" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>{
    "root": {
        "id": "toplevel",
        "relevance": 1.0,
        "fields": {
            "totalCount": 597
        },
        "coverage": {
            "coverage": 100,
            "documents": 10000,
            "full": true,
            "nodes": 1,
            "results": 1,
            "resultsFull": 1
        },
        "children": [
            {
                "id": "id:doc:doc::4753",
                "relevance": 0.18904411884161854,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        "closeness(field,embedding)": 0.18904411884161854,
                        ...
                        "distance(field,embedding)": 4.289770483882663
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::4753",
                    "text": "For a <strong>healthy daily calorie count</strong>, allow 10 calories per pound of body weight ...",
                    "color": "green"
                }
            },
            {
                "id": "id:doc:doc::4528",
                "relevance": 0.1750265633743142,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        "closeness(field,embedding)": 0.1750265633743142,
                        ...
                        "distance(field,embedding)": 4.713418470437464
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::4528",
                    "text": "... calories in each gram -- 1 g of fat provides 9 calories. If you consume 2,500 <strong>calories per day</strong>, ...",
                    "color": "yellow"
                }
            },
            {
                "id": "id:doc:doc::9349",
                "relevance": 0.17466600309410665,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        "closeness(field,embedding)": 0.17466600309410665,
                        ...
                        "distance(field,embedding)": 4.725212590232682
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::9349",
                    "text": "The <strong>Zone diet typically caps daily calories</strong> for women at 1,200 and 1,500 for men...",
                    "color": "pink"
                }
            },

...</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-0e54b95 elementor-widget elementor-widget-text-editor" data-id="0e54b95" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">该查询最重要的参数是:</p>
<p class="translated"><!-- /wp:paragraph --></p>
<p class="translated"><!-- wp:list --></p>
<ul>
<li style="list-style-type: none;">
 
<ul><!-- wp:list-item --></ul>
</li>
</ul>
<ul>
<li style="list-style-type: none;">
 
<ul>
<li class="translated"><a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/nearest-neighbor-search.html#querying-using-nearestneighbor-query-operator"> <code><strong>targetHits</strong></code> </a> ( <strong>必选</strong>)查询标注。<br/>它指定了查询中涉及的每个节点想要暴露给第一阶段排名的结果的数量。这是每个节点的下限，通过精确搜索，比<em> targetHits </em>更多的命中被暴露给第一阶段排名。</li>
</ul>
</li>
</ul>
<p class="translated"><!-- /wp:list-item --></p>
<p class="translated"><!-- wp:list-item --></p>
<ul>
<li style="list-style-type: none;">
 
<ul>
<li class="translated"><a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/query-language-reference.html#approximate"> <code><strong>approximate</strong></code> </a>查询标注。它指定了我们是否想要进行精确的或近似的最近邻搜索。精确搜索通过<code>approximate:false</code>设置进行设置，否则，使用默认的<code>approximate:true</code>并进行近似搜索。</li>
</ul>
</li>
</ul>
<p class="translated"><!-- /wp:list-item --></p>
<p class="translated"><!-- wp:list-item --></p>
<ul>
<li style="list-style-type: none;">
 
<ul>
<li class="translated"><code><strong>first_query</strong></code>可变。<br/>它应该与等级配置文件中定义的查询输入相匹配。它在<code>nearestNeighbor</code>和<code>input.query()</code>方法中用来指定我们传递的输入。</li>
</ul>
</li>
</ul>
<p class="translated"><!-- /wp:list-item --></p>
<p class="translated"><!-- wp:list-item --></p>
<ul>
<li style="list-style-type: none;">
 
<ul>
<li class="translated"><code><strong>input.query()</strong></code>方法。它定义了我们正在使用的等级档案的输入之一。在这种情况下，它将嵌入传递给我们的神经查询。<code>embed()</code>是调用在<em> service.xml </em>中定义的嵌入器的方法(如果使用多个嵌入器，需要给出一个<em> id </em>，如这里的<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/embedding.html#embedding-a-query-text">所解释的</a>)并计算文本查询<em>“减肥要吃多少卡路里”</em>的向量。</li>
</ul>
</li>
</ul>
<p class="translated"><!-- /wp:list-item --></p>
<p class="translated"><!-- wp:list-item --></p>
<ul>
<li style="list-style-type: none;">
 
<ul>
<li class="translated"><code><strong>ranking=pure_neural_rank</strong></code>参数。<br/>它定义了用于查询的等级配置文件。在本例中，我们将使用<em> pure_neural_rank </em>。</li>
</ul>
</li>
</ul>
<p class="translated"><!-- /wp:list-item --></p>
<p class="translated"><!-- /wp:list --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-e8d1d96 elementor-widget elementor-widget-iheading" data-id="e8d1d96" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h3 class="main-heading translated">6.2近似最近邻搜索</h3>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-2d65430 elementor-widget elementor-widget-text-editor" data-id="2d65430" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">要使用<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/nearest-neighbor-search-guide.html#approximate-nearest-neighbor-search">近似最近邻</a>，只需省略<code>approximate</code>参数，默认为<em>真</em>:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-b9a5604 elementor-widget elementor-widget-text-editor" data-id="b9a5604" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>vespa query "yql=select * from doc where {targetHits: 100}nearestNeighbor(embedding, first_query)" "input.query(first_query)=embed(#of calories to eat to lose weight)" "ranking=pure_neural_rank"</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-be9a1dc elementor-widget elementor-widget-iheading" data-id="be9a1dc" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>RESPONSE</span>
	        	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-9200e65 elementor-widget elementor-widget-text-editor" data-id="9200e65" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>{
    "root": {
        "id": "toplevel",
        "relevance": 1.0,
        "fields": {
            "totalCount": 100
        },
        "coverage": {
            "coverage": 100,
            "documents": 10000,
            "full": true,
            "nodes": 1,
            "results": 1,
            "resultsFull": 1
        },
        "children": [
            {
                "id": "id:doc:doc::4753",
                "relevance": 0.1890441216634541,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        "closeness(field,embedding)": 0.1890441216634541,
                        ...
                        "distance(field,embedding)": 4.289770404922987
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::4753",
                    "text": "For a <strong>healthy daily calorie count</strong>, allow 10 calories per pound of body weight ...",
                    "color": "green"
                }
            },
            {
                "id": "id:doc:doc::4528",
                "relevance": 0.1750265612999238,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        "closeness(field,embedding)": 0.1750265612999238,
                        ...
                        "distance(field,embedding)": 4.713418538152102
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::4528",
                    "text": "... If you consume 2,500 <strong>calories per day</strong>, your fat intake should range from 56 g to 97 g. Recommendations for fat are further specified by type of fat.",
                    "color": "yellow"
                }
            },
            {
                "id": "id:doc:doc::9349",
                "relevance": 0.1746659943912434,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        "closeness(field,embedding)": 0.1746659943912434,
                        ...
                        "distance(field,embedding)": 4.7252128754956635
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::9349",
                    "text": "The <strong>Zone diet typically caps daily calories</strong> for women at 1,200 and 1,500 for men...",
                    "color": "pink"
                }
            },
...</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-c6b786b elementor-widget elementor-widget-iheading" data-id="c6b786b" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h3 class="main-heading translated">6.3使用查询过滤器的近似最近邻</h3>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-a6c2ded elementor-widget elementor-widget-text-editor" data-id="a6c2ded" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">可以将最近邻搜索与<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/nearest-neighbor-search-guide.html#combining-approximate-nearest-neighbor-search-with-query-filters">过滤器</a>集成。<br/>让我们用以下方式对色域进行过滤:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-618deb9 elementor-widget elementor-widget-text-editor" data-id="618deb9" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>vespa query "yql=select * from doc where {targetHits: 100}nearestNeighbor(embedding, first_query) <strong>AND color contains 'yellow'</strong>" "input.query(first_query)=embed(#of calories to eat to lose weight)" "ranking=pure_neural_rank"</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-f9f04ca elementor-widget elementor-widget-iheading" data-id="f9f04ca" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>RESPONSE</span>
	        	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-e9b0b05 elementor-widget elementor-widget-text-editor" data-id="e9b0b05" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>{
    "root": {
        "id": "toplevel",
        "relevance": 1.0,
        "fields": {
            "totalCount": 100
        },
        "coverage": {
            "coverage": 100,
            "documents": 10000,
            "full": true,
            "nodes": 1,
            "results": 1,
            "resultsFull": 1
        },
        "children": [
            {
                "id": "id:doc:doc::4528",
                "relevance": 0.1750265612999238,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        "closeness(field,embedding)": 0.1750265612999238,
                        ...
                        "distance(field,embedding)": 4.713418538152102
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::4528",
                    "text": "... If you consume 2,500 <strong>calories per day</strong>, your fat intake should range from 56 g to 97 g...",
                    <strong>"color": "yellow"</strong>
                }
            },
            {
                "id": "id:doc:doc::4947",
                "relevance": 0.16819859694194497,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        "closeness(field,embedding)": 0.16819859694194497,
                        ...
                        "distance(field,embedding)": 4.945352804251736
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::4947",
                    "text": "<strong>How Many Calories</strong> are in the Alcohol ...",
                    <strong>"color": "yellow"</strong>
                }
            },
            {
                "id": "id:doc:doc::9348",
                "relevance": 0.1666637050622998,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        "closeness(field,embedding)": 0.1666637050622998,
                        ...
                        "distance(field,embedding)": 5.000106619651799
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::9348",
                    "text": "You can use Weight Loss Resources to follow the <strong>Zone diet</strong> by setting your target nutrition profile ...",
                    <strong>"color": "yellow"</strong>
                }
            },
...</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-63e65db elementor-widget elementor-widget-text-editor" data-id="63e65db" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">这里Vespa只返回颜色为<em>黄色</em>的文档，因为它使用<strong>预过滤</strong>。关于Vespa中过滤如何工作的更多细节，请查看这些参考资料:<br/><a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/nearest-neighbor-search-guide.html#controlling-filter-behavior">https://docs . Vespa . ai/en/nearest-neighbor-search-guide . html # controlling-filter-behavior<br/></a><a href="https://web.archive.org/web/20230314041044/https://blog.vespa.ai/constrained-approximate-nearest-neighbor-search/">https://blog . Vespa . ai/constrained-approximate-neighbor-search/</a></p>
<p class="translated">正如在Vespa <a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/nearest-neighbor-search-guide.html#strict-filters-and-distant-neighbors">文档</a> : <em>中提到的，“使用严格的过滤器，返回的邻居可能质量较低(距离较远)。解决这个问题的一个方法是使用nearestNeighbor查询运算符的<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/query-language-reference.html#distancethreshold"> distanceThreshold </a>查询注释参数。</em>。<br/>因为距离值取决于使用的<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/schema-reference.html#distance-metric">距离度量</a>。通过将<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/rank-features.html#distance(dimension,name)">距离(场，嵌入)</a>等级特征添加到等级简档的匹配特征，可以分析什么距离可以被认为太远。</p>
<p class="translated">这可以在查询中定义为:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-1c72df7 elementor-widget elementor-widget-text-editor" data-id="1c72df7" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">vespa query "yql=select * from doc where {<strong>distanceThreshold: 5.0</strong>, targetHits: 100}nearestNeighbor(embedding, first_query) AND color contains 'yellow'" "input.query(first_query)=embed(#of calories to eat to lose weight)" "ranking=pure_neural_rank"</pre>
<p class="translated"><!-- /wp:preformatted --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-c7a8619 elementor-widget elementor-widget-iheading" data-id="c7a8619" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>RESPONSE</span>
	        	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-3ea25ad elementor-widget elementor-widget-text-editor" data-id="3ea25ad" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>{
    "root": {
        "id": "toplevel",
        "relevance": 1.0,
        "fields": {
            <strong>"totalCount": 2</strong>
        },
        "coverage": {
            "coverage": 100,
            "documents": 10000,
            "full": true,
            "nodes": 1,
            "results": 1,
            "resultsFull": 1
        },
        "children": [
            {
                "id": "id:doc:doc::4528",
                "relevance": 0.1750265612999238,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        "closeness(field,embedding)": 0.1750265612999238,
                        ...
                        <strong>"distance(field,embedding)": 4.713418538152102</strong>
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::4528",
                    "text": "Fat is the most energy-dense macronutrient, which means it contains the most calories ...",
                    "color": "yellow"
                }
            },
            {
                "id": "id:doc:doc::4947",
                "relevance": 0.16819859694194497,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        "closeness(field,embedding)": 0.16819859694194497,
                        ...
                        <strong>"distance(field,embedding)": 4.945352804251736</strong>
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::4947",
                    "text": "How Many Calories are in the Alcohol You Like to Drink? import 2014-05-19T05:40:13+00:00...",
                    "color": "yellow"
                }
            }
        ]
    }
}</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-c111b40 elementor-widget elementor-widget-text-editor" data-id="c111b40" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">如您所见，现在只返回两个文档，即距离小于5的文档。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-4b2340b elementor-widget elementor-widget-iheading" data-id="4b2340b" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h3 class="main-heading translated">6.4混合稀疏和密集检索方法</h3>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-ffc5e14 elementor-widget elementor-widget-text-editor" data-id="ffc5e14" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">刚才看到的密集检索可以<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/nearest-neighbor-search-guide.html#hybrid-sparse-and-dense-retrieval-methods-with-vespa">结合</a>传统的稀疏检索。如等级配置文件中所述，我们已经在<em> hybrid_rank </em>等级配置文件的定义中实现了该行为。</p>
<p class="translated">为了用，就用<em> hybrid_rank </em>一个换排名:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-5df5774 elementor-widget elementor-widget-text-editor" data-id="5df5774" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>vespa query "yql=select * from doc where {targetHits: 100}nearestNeighbor(embedding, first_query) OR text contains 'exercise'" "type=weakAnd" "<strong>ranking=hybrid_rank</strong>" "input.query(first_query)=embed(#of calories to eat to lose weight)"</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-323e9ff elementor-widget elementor-widget-iheading" data-id="323e9ff" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>RESPONSE</span>
	        	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-7903f84 elementor-widget elementor-widget-text-editor" data-id="7903f84" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>{
    "root": {
        "id": "toplevel",
        "relevance": 1.0,
        "fields": {
            "totalCount": 135
        },
        "coverage": {
            "coverage": 100,
            "documents": 10000,
            "full": true,
            "nodes": 1,
            "results": 1,
            "resultsFull": 1
        },
        "children": [
            {
                "id": "id:doc:doc::4761",
                <strong>"relevance": 9.125252513334813,</strong>
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        <strong>"bm25(text)": 8.97712592472415</strong>,
                        <strong>"closeness(field,embedding)": 0.1481265886106627</strong>
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::4761",
                    "text": "A report by the Mayo Clinic indicates that <strong>proper nutrition</strong> can boost any <strong>exercise</strong> ...",
                    "color": "white"
                }
            },
            {
                "id": "id:doc:doc::8732",
                <strong>"relevance": 9.081256342626082,</strong>
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        <strong>"bm25(text)": 8.95203518376092,</strong>
                        <strong>"closeness(field,embedding)": 0.12922115886516217</strong>
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::8732",
                    "text": "The form of <strong>exercise</strong> increases...",
                    "color": "black"
                }
            },
            {
                "id": "id:doc:doc::4756",
                <strong>"relevance": 8.669726817466929,</strong>
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        <strong>"bm25(text)": 8.498001371344154,
                        "closeness(field,embedding)": 0.17172544612277515</strong>
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::4756",
                    "text": "As a rule of thumb, <strong>weight loss is generally 75 percent diet and 25 percent exercise</strong>...",
                    "color": "green"
                }
            },
...</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-835a95d elementor-widget elementor-widget-text-editor" data-id="835a95d" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">该查询使用逻辑析取(or)将<em>最近邻居</em>运算符与<em> <a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/reference/query-language-reference.html#weakand"> weakAnd </a> </em>运算符组合在一起(您可以在这里找到关于weakAnd如何工作的更多信息<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/using-wand-with-vespa.html#weakand">)。这种类型的查询支持基于语义(向量距离)和传统稀疏(精确)匹配的检索。</a></p>
<p class="translated">为了能够计算文本字段的<em> bm25 </em>指标，我们向查询添加了<em>“或文本包含‘练习’”</em>条件。</p>
<p class="translated">对于我们如何定义等级配置文件，也可以将<em>文本</em>和<em>向量</em>权重传递给相关性表达式。在第一个查询示例中，查询的输入中没有给定权重，因此将默认值1分配给两者。关联度确实是<em> bm25 </em>和<em>亲密度</em>之和。<br/>关联式的<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/nearest-neighbor-search-guide.html#hybrid-sparse-and-dense-retrieval-methods-with-vespa">权重</a>可以用<code>ranking.features.query()</code>方法设置为:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-ed4195e elementor-widget elementor-widget-text-editor" data-id="ed4195e" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">vespa query "yql=select * from doc where {targetHits: 100}nearestNeighbor(embedding, first_query) OR text contains 'exercise'" "type=weakAnd" "ranking=hybrid_rank" "input.query(first_query)=embed(#of calories to eat to lose weight)" "<strong>ranking.features.query(textWeight)=0.5</strong>" "<strong>ranking.features.query(vectorWeight)=30</strong>"</pre>
<p class="translated"><!-- /wp:preformatted --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-11da124 elementor-widget elementor-widget-iheading" data-id="11da124" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>RESPONSE</span>
	        	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-b8ebfc1 elementor-widget elementor-widget-text-editor" data-id="b8ebfc1" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>{
    "root": {
        "id": "toplevel",
        "relevance": 1.0,
        "fields": {
            "totalCount": 135
        },
        "coverage": {
            "coverage": 100,
            "documents": 10000,
            "full": true,
            "nodes": 1,
            "results": 1,
            "resultsFull": 1
        },
        "children": [
            {
                <strong>"id": "id:doc:doc::4756"</strong>,
                <strong>"relevance": 9.400764069355333,</strong>
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        "bm25(text)": 8.498001371344154,
                        "closeness(field,embedding)": 0.17172544612277515
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::4756",
                    "text": "As a rule of thumb, <strong>weight loss is generally 75 percent diet and 25 percent exercise</strong>...",
                    "color": "green"
                }
            },
            {
                <strong>"id": "id:doc:doc::4761"</strong>,
                <strong>"relevance": 8.932360620681955</strong>,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        "bm25(text)": 8.97712592472415,
                        "closeness(field,embedding)": 0.1481265886106627
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::4761",
                    "text": "A report by the Mayo Clinic indicates that proper <strong>nutrition</strong> can boost any <strong>exercise</strong> routine ...",
                    "color": "white"
                }
            },
            {
                <strong>"id": "id:doc:doc::4277"</strong>,
                <strong>"relevance": 8.836020903237696</strong>,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        "bm25(text)": 8.165063896210217,
                        "closeness(field,embedding)": 0.1584496318377529
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::4277",
                    "text": "11 8. â<strong>Exercise</strong> is an effective method of weight management.âs cardio, resistance training or flexibility work, <strong>rely on the nutrition you provide them through your diet</strong>...",
                    "color": "black"
                }
            },
...</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-f5b7e89 elementor-widget elementor-widget-text-editor" data-id="f5b7e89" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">多亏了权重，我们才能够更加重视最终相关性的接近程度。我们可以在排名上升的文档<em> 4756 </em>上看到新的行为。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-5718525 elementor-widget elementor-widget-iheading" data-id="5718525" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h3 class="main-heading translated">6.5同一查询中的多个最近邻搜索运算符</h3>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-9f727ec elementor-widget elementor-widget-text-editor" data-id="9f727ec" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">也可以用<a href="https://web.archive.org/web/20230314041044/https://docs.vespa.ai/en/nearest-neighbor-search-guide.html#multiple-nearest-neighbor-search-operators-in-the-same-query">多重嵌入</a>查询。为此，只需在查询中组合多个<em>最近邻</em>操作符:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-fd25bdb elementor-widget elementor-widget-text-editor" data-id="fd25bdb" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">vespa query "yql=select * from doc where <strong>({<strong>label:'first_query'</strong>,</strong> <strong>targetHits:100}nearestNeighbor(embedding, first_query)) OR ({<strong>label:'second_query'</strong>,</strong> <strong>targetHits:100}nearestNeighbor(embedding, second_query))</strong>" "ranking=<strong>pure_neural_rank</strong>" "input.query(first_query)=embed(#of calories to eat to lose weight)" "input.query(second_query)=embed(diet zone strategy)"</pre>
<p class="translated"><!-- /wp:preformatted --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-35a7033 elementor-widget elementor-widget-iheading" data-id="35a7033" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>RESPONSE</span>
	        	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-57fabf7 elementor-widget elementor-widget-text-editor" data-id="57fabf7" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>{
    "root": {
        "id": "toplevel",
        "relevance": 1.0,
        "fields": {
            "totalCount": 161
        },
        "coverage": {
            "coverage": 100,
            "documents": 10000,
            "full": true,
            "nodes": 1,
            "results": 1,
            "resultsFull": 1
        },
        "children": [
            {
                "id": "id:doc:doc::4753",
                <strong>"relevance": 0.1890441216634541</strong>,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        <strong>"closeness(field,embedding)": 0.1890441216634541</strong>,
                        <strong>"closeness(label,first_query)": 0.1890441216634541</strong>,
                        "closeness(label,second_query)": 0.11298739153572483,
                        "distance(field,embedding)": 4.289770404922987
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::4753",
                    "text": "For a healthy daily calorie count, allow 10 calories per pound of body weight -- so a 150-pound woman ...",
                    "color": "green"
                }
            },
            {
                "id": "id:doc:doc::4528",
                <strong>"relevance": 0.1750265612999238</strong>,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        <strong>"closeness(field,embedding)": 0.1750265612999238</strong>,
                        <strong>"closeness(label,first_query)": 0.1750265612999238</strong>,
                        "closeness(label,second_query)": 0.11656046297833024,
                        "distance(field,embedding)": 4.713418538152102
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::4528",
                    "text": "Fat is the most energy-dense macronutrient, which means it contains the most calories in each gram ...",
                    "color": "yellow"
                }
            },
            {
                "id": "id:doc:doc::9349",
                <strong>"relevance": 0.1746659943912434</strong>,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        <strong>"closeness(field,embedding)": 0.1746659943912434</strong>,
                        <strong>"closeness(label,first_query)": 0.1746659943912434</strong>,
                        "closeness(label,second_query)": 0.13456681371668433,
                        "distance(field,embedding)": 4.7252128754956635
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::9349",
                    "text": "The Zone diet typically caps daily calories for women at 1,200 and 1,500 for men...",
                    "color": "pink"
                }
            },
...</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-4d05a43 elementor-widget elementor-widget-text-editor" data-id="4d05a43" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">这里我们使用了<em> pure_neural_rank </em>等级配置文件，其中相关性是最大<em>接近度</em>。<br/>为了改变相关性计算，并使用两个向量的接近度的<strong>和，只需将排名改为<em>neural _ rank _ sum _ cloness</em>排名概况:</strong></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-03e66b1 elementor-widget elementor-widget-text-editor" data-id="03e66b1" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">vespa query "yql=select * from doc where ({<strong>label:'first_query'</strong>, targetHits:100}nearestNeighbor(embedding, first_query)) OR ({<strong>label:'second_query'</strong>, targetHits:100}nearestNeighbor(embedding, second_query))" "<strong>ranking=neural_rank_sum_closeness</strong>" "input.query(first_query)=embed(#of calories to eat to lose weight)" "input.query(second_query)=embed(diet zone strategy)"</pre>
<p class="translated"><!-- /wp:preformatted --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-0f6be32 elementor-widget elementor-widget-iheading" data-id="0f6be32" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>RESPONSE</span>
	        	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-4b263c5 elementor-widget elementor-widget-text-editor" data-id="4b263c5" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:code --></p>
<pre class="wp-block-code"><code>{
    "root": {
        "id": "toplevel",
        "relevance": 1.0,
        "fields": {
            "totalCount": 161
        },
        "coverage": {
            "coverage": 100,
            "documents": 10000,
            "full": true,
            "nodes": 1,
            "results": 1,
            "resultsFull": 1
        },
        "children": [
            {
                <strong>"id": "id:doc:doc::9349"</strong>,
                <strong>"relevance": 0.30923280810792775</strong>,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        "closeness(field,embedding)": 0.1746659943912434,
                        <strong>"closeness(label,first_query)": 0.1746659943912434</strong>,
                        <strong>"closeness(label,second_query)": 0.13456681371668433</strong>
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::9349",
                    "text": "The <strong>Zone diet typically caps daily calories</strong> for women at 1,200 and 1,500 for men...",
                    "color": "pink"
                }
            },
            {
                "id": "id:doc:doc::9348",
                <strong>"relevance": 0.30526075530543645</strong>,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        "closeness(field,embedding)": 0.1666637050622998,
                        <strong>"closeness(label,first_query)": 0.1666637050622998</strong>,
                        <strong>"closeness(label,second_query)": 0.13859705024313665</strong>
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::9348",
                    "text": "<strong>You can use Weight Loss Resources to follow the Zone diet</strong> by setting your target nutrition...",
                    "color": "yellow"
                }
            },
            {
                "id": "id:doc:doc::4753",
                <strong>"relevance": 0.3020315131991789</strong>,
                "source": "text",
                "fields": {
                    "matchfeatures": {
                        "closeness(field,embedding)": 0.1890441216634541,
                        <strong>"closeness(label,first_query)": 0.1890441216634541</strong>,
                        <strong>"closeness(label,second_query)": 0.11298739153572483</strong>
                    },
                    "sddocname": "doc",
                    "documentid": "id:doc:doc::4753",
                    "text": "For a <strong>healthy daily calorie count</strong>, allow 10 calories per pound ...",
                    "color": "green"
                }
            },
...</code></pre>
<p class="translated"><!-- /wp:code --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-3ea1a8f elementor-widget elementor-widget-text-editor" data-id="3ea1a8f" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">如前所述，在最后两个例子中，我们利用标签分别显示每个查询张量的<em>接近度</em>值。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-3bf206d elementor-widget elementor-widget-iheading" data-id="3bf206d" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h2 class="main-heading translated">摘要</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-78aaad8 elementor-widget elementor-widget-text-editor" data-id="78aaad8" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">Vespa提供了一种全面且高度可定制的方法来实现神经搜索。所提供的产品有很多优点:</p>
<ul>
<li class="translated">在Vespa <br/> <br/>中集成定制模型的可能性</li>
<li class="translated">只需调用<em> services.xml <br/> <br/> </em>中的嵌入器，就可以在内部创建嵌入</li>
<li class="translated">过滤的管理方式，默认为预过滤<br/> <br/></li>
<li class="translated">通过组合不同的度量标准<br/> <br/>来定制相关性表达式的可能性</li>
<li class="translated">通过单独打印所有必要的指标，可以轻松调试相关性</li>
</ul>
<p class="translated">由于高度定制化，我们发现系统实现并不简单。在能够部署最小系统之前，有必要对所有组件和配置进行深入研究。文档很详细，但有时有点难以理解，因为相同的特性/概念可以在几个不同的页面上描述。</p>
<p class="translated">无论如何，我们发现Vespa是实现神经搜索的一个很好的系统，必须指出的是，Vespa团队在<a href="https://web.archive.org/web/20230314041044/http://slack.vespa.ai/"> Slack channel </a>上非常活跃和有帮助。</p>
<p class="translated">感谢您的阅读，下一篇博文再见！</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-1a2bd6d1 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="1a2bd6d1" data-element_type="section" data-settings="{&quot;background_background&quot;:&quot;classic&quot;}">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-782af914 ot-flex-column-vertical" data-id="782af914" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-273b67a0 elementor-widget elementor-widget-iheading" data-id="273b67a0" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>// our service</span>
	        <h2 class="main-heading translated">不要脸的塞给我们培训和服务！</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-e53b253 elementor-widget elementor-widget-text-editor" data-id="e53b253" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">我有没有提到我们有很多关于神经搜索的训练课？你可以从搜索的<a href="https://web.archive.org/web/20230314041044/https://sease.io/information-retrieval-mini-training/deep-learning-open-source-approaches-1-day-training">深度学习——开源方法</a>开始。<br/>我们也提供关于这些主题的咨询，<a href="https://web.archive.org/web/20230314041044/https://sease.io/contacts">如果你想用人工智能的力量把你的搜索引擎带到一个新的水平，请联系</a>！</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-6b4a5738 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="6b4a5738" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-772a2c37 ot-flex-column-vertical" data-id="772a2c37" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-17167df1 elementor-widget elementor-widget-iheading" data-id="17167df1" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>// STAY ALWAYS UP TO DATE</span>
	        <h2 class="main-heading translated">订阅我们的时事通讯</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-42b5c395 elementor-widget elementor-widget-text-editor" data-id="42b5c395" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">你喜欢这个关于Vespa神经搜索教程的帖子吗？不要忘记订阅我们的时事通讯，以便在信息检索世界中保持最新状态！</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-2830fe1a elementor-widget elementor-widget-wp-widget-mc4wp_form_widget" data-id="2830fe1a" data-element_type="widget" data-widget_type="wp-widget-mc4wp_form_widget.default">
				<div class="elementor-widget-container">
			<script>(function() {
	window.mc4wp = window.mc4wp || {
		listeners: [],
		forms: {
			on: function(evt, cb) {
				window.mc4wp.listeners.push(
					{
						event   : evt,
						callback: cb
					}
				);
			}
		}
	}
})();
</script><!-- Mailchimp for WordPress v4.9.1 - https://wordpress.org/plugins/mailchimp-for-wp/ --><form id="mc4wp-form-1" class="mc4wp-form mc4wp-form-1343" method="post" data-id="1343" data-name="Sease Mailchimp"><div class="mc4wp-form-fields">
<div class="subscribe-inner-form">
	<input type="email" name="EMAIL" placeholder="Your Email" required=""/>
	<button type="submit" class="subscribe-btn-icon"><i class="flaticon-telegram"/></button>
</div>	

<p class="translated"><label> <input name="AGREE_TO_TERMS" type="checkbox" value="1" required=""/> <a href="https://web.archive.org/web/20230314041044/https://sease.io/privacy-policy" target="_blank">我已经阅读并同意隐私政策</a> </label></p></div><label style="display: none !important;">Leave this field empty if you're human: <input type="text" name="_mc4wp_honeypot" value="" tabindex="-1" autocomplete="off"/></label><input type="hidden" name="_mc4wp_timestamp" value="1678767045"/><input type="hidden" name="_mc4wp_form_id" value="1343"/><input type="hidden" name="_mc4wp_form_element_id" value="mc4wp-form-1"/><div class="mc4wp-response"/></form><!-- / Mailchimp for WordPress Plugin -->		</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
									    
</body>
</html>