<html>
<head>
<title>Elasticsearch _source, doc_values and store Performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Elasticsearch _source、doc_values和商店绩效</h1>
<blockquote>原文：<a href="https://web.archive.org/web/sease.io/2021/02/field-retrieval-performance-in-elasticsearch.html#0001-01-01">https://web.archive.org/web/sease.io/2021/02/field-retrieval-performance-in-elasticsearch.html#0001-01-01</a></blockquote>
									<section class="elementor-section elementor-top-section elementor-element elementor-element-4ad64d98 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="4ad64d98" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-5307c08 ot-flex-column-vertical" data-id="5307c08" data-element_type="column">
			<div class="elementor-column-wrap">
							<div class="elementor-widget-wrap">
								</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-774735fc ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="774735fc" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-1864d81c ot-flex-column-vertical" data-id="1864d81c" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-5cbe90f elementor-widget elementor-widget-text-editor" data-id="5cbe90f" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:paragraph --></p>
<p class="translated">在这篇博文中，我想从性能的角度探讨一下elasticsearch为我们存储字段和在查询时检索字段提供了哪些可能性<strong/>。事实上，构建elasticsearch和solr的底层库lucene提供了两种存储和检索字段的方法:存储字段和文档值。此外，elasticsearch使用_source字段作为默认字段，这是一个很大的json，包含在索引时作为输入给出的文档的所有字段。</p>
<p class="translated"><!-- /wp:paragraph --> <!-- wp:paragraph --></p>
<p class="translated">为什么elasticsearch使用_source字段作为默认字段，从性能角度来看，所有这些可能性有什么不同？让我们来了解一下！</p>
<p class="translated"><!-- /wp:paragraph --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-2465de0e elementor-widget elementor-widget-iheading" data-id="2465de0e" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h2 class="main-heading translated">lucene中的存储和文档值字段</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-479bc85a elementor-widget elementor-widget-text-editor" data-id="479bc85a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">当我们在lucene中索引一个文档时，关于已经被索引的原始字段的信息会丢失。根据模式配置对字段进行分析、转换和索引。在没有任何附加数据结构的情况下，当我们搜索一个文档时，我们得到的是被搜索文档的id，而不是原始字段。为了获得这些信息，我们需要额外的数据结构。Lucene为此提供了两种可能性:存储字段和文档值。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-41641d6a elementor-widget elementor-widget-iheading" data-id="41641d6a" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h6 class="main-heading translated">存储字段</h6>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-52075fe3 elementor-widget elementor-widget-text-editor" data-id="52075fe3" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">存储字段的目的是存储字段的值(不进行任何分析)，以便在查询时检索它们。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-4693d393 elementor-widget elementor-widget-iheading" data-id="4693d393" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h6 class="main-heading translated">文档值</h6>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-12353c36 elementor-widget elementor-widget-text-editor" data-id="12353c36" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:paragraph --></p>
<p class="translated">引入文档值是为了加快分面、分类和分组等操作。Docvalues还可以用于在查询时返回字段值。唯一的限制是我们不能将它们用于文本字段。</p>
<p class="translated"><!-- /wp:paragraph --> <!-- wp:paragraph --></p>
<p class="translated">存储的字段和文档值在lucene库中实现，它们可以在solr和elasticsearch中使用。</p>
<p class="translated"><!-- /wp:paragraph --> <!-- wp:paragraph --></p>
<p class="translated">我写过一篇博文，比较了solr中存储字段和docvalues的字段检索性能:</p>
<p class="translated"><a href="https://web.archive.org/web/20220925163558/https://sease.io/2021/02/field-retrieval-performance-in-elasticsearch.html" target="_blank" rel="noreferrer noopener" data-rich-text-format-boundary="true">文档值与存储字段:Apache Solr特性和性能对比</a></p>
<p class="translated">在那里，您可以找到关于存储字段和文档值、它们的利用率和约束的更详细的描述。</p>
<p class="translated"><!-- /wp:paragraph --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-339f7001 elementor-widget elementor-widget-iheading" data-id="339f7001" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h2 class="main-heading translated">弹性研究中的字段检索</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-b3aad9a elementor-widget elementor-widget-text-editor" data-id="b3aad9a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">如果我们在映射中明确定义存储的字段和文档值，则它们可以在elasticsearch中使用:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-79c63dee elementor-widget elementor-widget-html" data-id="79c63dee" data-element_type="widget" data-widget_type="html.default">
				<div class="elementor-widget-container">
			<code>  "properties" : {<br/>
        "field": {<br/>
        "type": "keyword",<br/>
         "store": true,<br/>
          "doc_values" true<br/>
     }<br/>
 }</code>		</div>
				</div>
				<div class="elementor-element elementor-element-7e22c602 elementor-widget elementor-widget-text-editor" data-id="7e22c602" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:paragraph --></p>
<p class="translated">默认情况下，每个字段的store都设置为false。相反，默认情况下，所有支持文档值的字段都会启用它们。</p>
<p class="translated"><!-- /wp:paragraph --> <!-- wp:paragraph --></p>
<p class="translated">独立于stored和docvalues配置，在查询时，将返回查询命中的文档中每个字段的值。这是因为elasticsearch使用另一个工具进行字段检索:字段<strong>elastic search</strong><strong>_ source</strong>。</p>
<p class="translated"><!-- /wp:paragraph --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-6212d5ed elementor-widget elementor-widget-iheading" data-id="6212d5ed" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h6 class="main-heading translated">弹性搜索_源字段</h6>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-3fff7c48 elementor-widget elementor-widget-text-editor" data-id="3fff7c48" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">源字段是索引时传递给elasticsearch的json。该字段在elasticsearch中默认设置为true，可以通过以下方式使用映射禁用:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-4095c8e6 elementor-widget elementor-widget-html" data-id="4095c8e6" data-element_type="widget" data-widget_type="html.default">
				<div class="elementor-widget-container">
			<code>  "mappings": {<br/>
      "_source": {<br/>
         "enabled": false<br/>
      }<br/>
   }</code>		</div>
				</div>
				<div class="elementor-element elementor-element-24c65de5 elementor-widget elementor-widget-text-editor" data-id="24c65de5" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:paragraph --></p>
<p class="translated">默认情况下，查询时会返回所有字段。您甚至可以指定在响应中只返回源中字段的子集。这应该可以加快响应在网络中的传输速度。</p>
<p class="translated"><!-- /wp:paragraph --> <!-- wp:paragraph --></p>
<p class="translated">有些字段可以通过适当的配置被源字段排除:</p>
<p class="translated"><!-- /wp:paragraph --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-73876540 elementor-widget elementor-widget-html" data-id="73876540" data-element_type="widget" data-widget_type="html.default">
				<div class="elementor-widget-container">
			<code>PUT logs<br/>
{<br/>
   "mappings": {<br/>
      "_source": {<br/>
         "excludes": [<br/>
            "meta.description",<br/>
            "meta.other.*"<br/>
         ]<br/>
      }<br/>
   }<br/>
}</code>		</div>
				</div>
				<div class="elementor-element elementor-element-4a17f08f elementor-widget elementor-widget-text-editor" data-id="4a17f08f" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:paragraph --></p>
<p class="translated">从源中排除字段将减少磁盘空间的使用，但被排除的字段永远不会在响应中返回。</p>
<p class="translated"><!-- /wp:paragraph -->T11】</p>
<p class="translated">禁用elasticsearch _source字段将无法更新文档，除非从头开始重新编制索引。事实上，为了更新文档，我们需要从旧文档中获取字段的值。从逻辑上讲，使用存储的字段或docvalues从旧文档中获取字段值应该是可行的(这就是solr中原子更新的工作方式)。但是，由于设计决策的原因，这在elasticsearch中是不允许的，如果您需要更新文档，您必须在elasticsearch索引配置中启用_source字段。</p>
<p class="translated"><!-- /wp:paragraph --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-3d8931d2 elementor-widget elementor-widget-iheading" data-id="3d8931d2" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h6 class="main-heading translated">检索字段</h6>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-6d74f3c8 elementor-widget elementor-widget-text-editor" data-id="6d74f3c8" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:paragraph --></p>
<p class="translated">在elasticsearch中，您可以启用或禁用_source字段，并使字段存储和/或文档值。但是如何在查询时检索字段呢？</p>
<p class="translated"><!-- /wp:paragraph -->T15】</p>
<p class="translated">默认情况下，如果定义了源，则返回整个源。您可以避免它，只返回源的子集，如下所示:</p>
<p class="translated"><!-- /wp:paragraph --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-18413e27 elementor-widget elementor-widget-html" data-id="18413e27" data-element_type="widget" data-widget_type="html.default">
				<div class="elementor-widget-container">
			<code>...<br/>
 "fields": ["field1", "field2"],<br/>
 "_source": false<br/>
...</code>		</div>
				</div>
				<div class="elementor-element elementor-element-682f0fd9 elementor-widget elementor-widget-text-editor" data-id="682f0fd9" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">但是，如果您没有启用源字段，并且您想从stored或docvalues返回字段，您必须以另一种方式告诉elasticsearch。对于您使用的每个源，您必须以不同的方式指定字段列表:</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-29cdca24 elementor-widget elementor-widget-html" data-id="29cdca24" data-element_type="widget" data-widget_type="html.default">
				<div class="elementor-widget-container">
			<code>...<br/>
 "fields": ["sv1", "sv2",...],<br/>
 "docvalue_fields": ["dv1", "dv2",...],<br/>
 "stored_fields" : ["s1", "s2",...],<br/>
...</code>		</div>
				</div>
				<div class="elementor-element elementor-element-4e5aaa2c elementor-widget elementor-widget-text-editor" data-id="4e5aaa2c" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">例如，如果您有一个既存储又文档值的字段，您可以选择是从文档值还是存储字段中检索它。从功能的角度来看，这是完全一样的，但是您的选择可能会影响查询的执行时间。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-1f0a6f08 elementor-widget elementor-widget-iheading" data-id="1f0a6f08" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h6 class="main-heading translated">存储字段、文档值和ELASTICSEARCH_SOURCE内部表示</h6>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-64eabd03 elementor-widget elementor-widget-text-editor" data-id="64eabd03" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">在本节中，我只想给出一个关于存储字段、_source字段和docvalues的内部内容的边缘概述，以便有一些工具来理解使用这些方法进行字段检索的预期性能。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-605161ba elementor-widget elementor-widget-iheading" data-id="605161ba" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>Stored fields internals</span>
	        	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-a0f1ea7 elementor-widget elementor-widget-text-editor" data-id="a0f1ea7" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">存储的字段以行的方式放在磁盘中:对于每个文档，我们有一行连续包含所有存储的字段。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-765b7cb9 elementor-widget elementor-widget-image" data-id="765b7cb9" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
								<div class="elementor-image">
												<img width="631" height="141" src="../Images/33015149f0223152cdd4d184e73819b7.png" class="attachment-full size-full" alt="" loading="lazy" srcset="https://web.archive.org/web/20220925163558im_/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/storedfields.png?w=631&amp;ssl=1 631w, https://web.archive.org/web/20220925163558im_/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/storedfields.png?resize=300%2C67&amp;ssl=1 300w" sizes="(max-width: 631px) 100vw, 631px" data-attachment-id="27517" data-permalink="https://web.archive.org/web/20220925163558/https://sease.io/2021/02/field-retrieval-performance-in-elasticsearch.html/storedfields" data-orig-file="https://web.archive.org/web/20220925163558/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/storedfields.png?fit=631%2C141&amp;ssl=1" data-orig-size="631,141" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="storedfields" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20220925163558/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/storedfields.png?fit=300%2C67&amp;ssl=1" data-large-file="https://web.archive.org/web/20220925163558/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/storedfields.png?fit=631%2C141&amp;ssl=1" data-original-src="https://web.archive.org/web/20220925163558im_/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/storedfields.png?fit=631%2C141&amp;ssl=1"/>														</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-6c680330 elementor-widget elementor-widget-text-editor" data-id="6c680330" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">以上图为例。为了访问文档x的字段3，我们必须访问文档x的行并跳过存储在字段3之前的所有字段。跳过一个字段需要获取它的长度。跳过字段不像读取字段那样昂贵，但是这种操作不是免费的。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-f8603a0 elementor-widget elementor-widget-iheading" data-id="f8603a0" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>Docvalues internals</span>
	        	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-28dc1232 elementor-widget elementor-widget-text-editor" data-id="28dc1232" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">文档值以列的方式存储。不同文档的相同字段的值被一起连续存储在存储器中，并且可以“几乎”直接访问特定文档的特定字段。计算想要的值的地址不是一个简单的操作，它有计算成本，但我们可以想象，如果我们只想要一个字段，使用这种访问更有效。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-2966c2dc elementor-widget elementor-widget-iheading" data-id="2966c2dc" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>ELASTICSEARCH _SOURCE FIELD INTERNALS</span>
	        	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-5ac042f9 elementor-widget elementor-widget-text-editor" data-id="5ac042f9" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">那么_source呢？嗯，如上所述，source是一个大字段，其中包含一个json，包含索引时提供给elasticsearch的所有输入。但是，这个字段实际上是如何存储的呢？毫不奇怪，elasticsearch利用了lucene已经实现并提供的机制:存储字段。特别是,_source字段是行中的第一个存储字段。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-406bd875 elementor-widget elementor-widget-image" data-id="406bd875" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
								<div class="elementor-image">
												<img width="571" height="141" src="../Images/eb0816ea8b7444d9203bf01c82cfd0ca.png" class="attachment-full size-full" alt="" loading="lazy" srcset="https://web.archive.org/web/20220925163558im_/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/sourcefield.jpg?w=571&amp;ssl=1 571w, https://web.archive.org/web/20220925163558im_/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/sourcefield.jpg?resize=300%2C74&amp;ssl=1 300w" sizes="(max-width: 571px) 100vw, 571px" data-attachment-id="27518" data-permalink="https://web.archive.org/web/20220925163558/https://sease.io/2021/02/field-retrieval-performance-in-elasticsearch.html/sourcefield" data-orig-file="https://web.archive.org/web/20220925163558/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/sourcefield.jpg?fit=571%2C141&amp;ssl=1" data-orig-size="571,141" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sourcefield" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20220925163558/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/sourcefield.jpg?fit=300%2C74&amp;ssl=1" data-large-file="https://web.archive.org/web/20220925163558/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/sourcefield.jpg?fit=571%2C141&amp;ssl=1" data-original-src="https://web.archive.org/web/20220925163558im_/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/sourcefield.jpg?fit=571%2C141&amp;ssl=1"/>														</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-169e1e81 elementor-widget elementor-widget-text-editor" data-id="169e1e81" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">必须阅读整个源代码才能使用其中包含的信息。如果我们想返回一个文档的所有字段，这个过程直观上是最快的。另一方面，如果我们只需要返回它包含的一小部分信息，那么读取这个巨大的字段可能会浪费计算能力。</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-35aa71f9 elementor-widget elementor-widget-iheading" data-id="35aa71f9" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        <h2 class="main-heading translated">标杆管理</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-711b13c2 elementor-widget elementor-widget-text-editor" data-id="711b13c2" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">为了对3种类型的字段进行基准测试，我在elasticsearch中创建了3个不同的索引。我已经索引了来自维基百科的100万个文档，对于每个文档，我用三种不同的方法索引了100个15个字符的字符串字段:在第一个索引中，我将字段设置为stored，在第二个索引中设置为docvalues。在这两个索引中，我禁用了源字段。在第三个索引中，我只是启用了source字段。</p>
<p class="translated">文档和查询集合取自<a href="https://web.archive.org/web/20220925163558/https://github.com/tantivy-search/search-benchmark-game">https://github.com/tantivy-search/search-benchmark-game</a>。我使用真实的集合来模拟真实的场景。</p>
<p class="translated"><!-- wp:paragraph --></p>
<p class="translated">执行细节:</p>
<p class="translated"><!-- /wp:paragraph --> <!-- wp:list --></p>
<ul>
<li class="translated">CPU: AMD RYZEN 3600</li>
<li class="translated">内存:32 GB</li>
</ul>
<p class="translated"><!-- /wp:list --> <!-- wp:paragraph --></p>
<p class="translated">对于每个查询，我请求最好的200个文档，并重复测试，从1到100改变要返回的字段数量(在我创建的100个随机字符串字段中)。</p>
<p class="translated"><!-- /wp:paragraph --> <!-- wp:paragraph --></p>
<p class="translated">这是基准测试的结果:</p>
<p class="translated"><!-- /wp:paragraph --></p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-335f0351 elementor-widget elementor-widget-image" data-id="335f0351" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
								<div class="elementor-image">
												<img width="640" height="480" src="../Images/a00bc0bcd1cd5cb2879b16241b1a0c70.png" class="attachment-full size-full" alt="" loading="lazy" srcset="https://web.archive.org/web/20220925163558im_/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/elastic-benachmarks.png?w=640&amp;ssl=1 640w, https://web.archive.org/web/20220925163558im_/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/elastic-benachmarks.png?resize=300%2C225&amp;ssl=1 300w" sizes="(max-width: 640px) 100vw, 640px" data-attachment-id="27520" data-permalink="https://web.archive.org/web/20220925163558/https://sease.io/2021/02/field-retrieval-performance-in-elasticsearch.html/elastic-benachmarks" data-orig-file="https://web.archive.org/web/20220925163558/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/elastic-benachmarks.png?fit=640%2C480&amp;ssl=1" data-orig-size="640,480" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="elastic-benchmarks" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20220925163558/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/elastic-benachmarks.png?fit=300%2C225&amp;ssl=1" data-large-file="https://web.archive.org/web/20220925163558/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/elastic-benachmarks.png?fit=640%2C480&amp;ssl=1" data-original-src="https://web.archive.org/web/20220925163558im_/https://i0.wp.com/sease.io/wp-content/uploads/2020/11/elastic-benachmarks.png?fit=640%2C480&amp;ssl=1"/>														</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-6fa71457 elementor-widget elementor-widget-text-editor" data-id="6fa71457" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated"><!-- wp:paragraph --></p>
<p class="translated">结果完全符合我们的预期。<strong>如果我们需要每个文档</strong>有几个字段，建议使用Docvalues。另一方面，当我们想要返回整个文档时，<strong> _source字段是最好的字段，存储字段的使用是其他两个字段之间的完美折衷。</strong></p>
<p class="translated"><!-- /wp:paragraph --> <!-- wp:paragraph --></p>
<p class="translated">在我所执行的基准测试场景中，如果我们只需要一个字段，那么<strong> docvalues的速度几乎是_source字段</strong> <strong>的两倍，相反，如果我们想要返回所有字段，那么图表显示当我们使用_source字段代替docvalues时，速度几乎提高了2倍。</strong></p>
<p class="translated"><!-- /wp:paragraph -->T11】</p>
<p class="translated">最后，性能不是我们必须考虑的唯一参数。正如我们在这篇博文中简要解释的那样，使用这种或那种方法都有一些限制。可能是因为您的用例的一些约束，您被迫使用这三个中的一个。而且即使从表现来看，我们也没有一个明确的赢家。</p>
<p class="translated"><!-- /wp:paragraph -->T13】</p>
<p class="translated">如果磁盘空间不成问题，<strong>您甚至可以混合使用不同的方法，将一个字段设置为stored和docvalue，并使源保持启用状态</strong>。在查询时，elasticsearch允许您选择所需的字段列表，以及是否希望它们从_source、stored或docvalues返回。</p>
<p class="translated"><!-- /wp:paragraph --></p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-26715119 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="26715119" data-element_type="section" data-settings="{&quot;background_background&quot;:&quot;classic&quot;}">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-6e8fbde1 ot-flex-column-vertical" data-id="6e8fbde1" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-356c5cff elementor-widget elementor-widget-iheading" data-id="356c5cff" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>// our service</span>
	        <h2 class="main-heading translated">不要脸的塞给我们培训和服务！</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-47a07422 elementor-widget elementor-widget-text-editor" data-id="47a07422" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">我提到过我们做<a href="https://web.archive.org/web/20220925163558/https://sease.io/training/elasticsearch-trainings/elasticsearch-beginner-training"> Elasticsearch初学者</a>和<a href="https://web.archive.org/web/20220925163558/https://sease.io/training/apache-solr-training/apache-solr-beginner-training"> Apache Solr初学者</a>培训吗？<br/>我们也提供这些话题的咨询，<a href="https://web.archive.org/web/20220925163558/https://sease.io/contacts">如果你想让你的搜索引擎更上一层楼，请联系</a>！</p>					</div>
						</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-62394a48 ot-traditional elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="62394a48" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
							<div class="elementor-row">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-1f6e15bf ot-flex-column-vertical" data-id="1f6e15bf" data-element_type="column">
			<div class="elementor-column-wrap elementor-element-populated">
							<div class="elementor-widget-wrap">
						<div class="elementor-element elementor-element-dd7bd74 elementor-widget elementor-widget-iheading" data-id="dd7bd74" data-element_type="widget" data-widget_type="iheading.default">
				<div class="elementor-widget-container">
					<div class="ot-heading">
	        	            <span>// STAY ALWAYS UP TO DATE</span>
	        <h2 class="main-heading translated">订阅我们的时事通讯</h2>	    </div>
	    		</div>
				</div>
				<div class="elementor-element elementor-element-369ee2b0 elementor-widget elementor-widget-text-editor" data-id="369ee2b0" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
								<div class="elementor-text-editor elementor-clearfix">
				<p class="translated">你喜欢这篇关于Elasticsearch _source、doc_values和商店绩效的帖子吗？不要忘记订阅我们的时事通讯，以便随时了解信息检索世界的最新动态！</p>					</div>
						</div>
				</div>
				<div class="elementor-element elementor-element-f9e23dd elementor-widget elementor-widget-wp-widget-mc4wp_form_widget" data-id="f9e23dd" data-element_type="widget" data-widget_type="wp-widget-mc4wp_form_widget.default">
				<div class="elementor-widget-container">
			<script>(function() {
	window.mc4wp = window.mc4wp || {
		listeners: [],
		forms: {
			on: function(evt, cb) {
				window.mc4wp.listeners.push(
					{
						event   : evt,
						callback: cb
					}
				);
			}
		}
	}
})();
</script><!-- Mailchimp for WordPress v4.8.8 - https://wordpress.org/plugins/mailchimp-for-wp/ --><form id="mc4wp-form-1" class="mc4wp-form mc4wp-form-1343" method="post" data-id="1343" data-name="Sease Mailchimp"><div class="mc4wp-form-fields">
<div class="subscribe-inner-form">
	<input type="email" name="EMAIL" placeholder="Your Email" required=""/>
	<button type="submit" class="subscribe-btn-icon"><i class="flaticon-telegram"/></button>
</div>	

<p class="translated"><label> <input name="AGREE_TO_TERMS" type="checkbox" value="1" required=""/> <a href="https://web.archive.org/web/20220925163558/https://sease.io/privacy-policy" target="_blank">我已经阅读并同意隐私政策</a> </label></p></div><label style="display: none !important;">Leave this field empty if you're human: <input type="text" name="_mc4wp_honeypot" value="" tabindex="-1" autocomplete="off"/></label><input type="hidden" name="_mc4wp_timestamp" value="1664123758"/><input type="hidden" name="_mc4wp_form_id" value="1343"/><input type="hidden" name="_mc4wp_form_element_id" value="mc4wp-form-1"/><div class="mc4wp-response"/></form><!-- / Mailchimp for WordPress Plugin -->		</div>
				</div>
						</div>
					</div>
		</div>
								</div>
					</div>
		</section>
									    
</body>
</html>